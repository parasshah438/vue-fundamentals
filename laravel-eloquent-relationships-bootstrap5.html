<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Eloquent Relationships - Complete Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Navigation */
        .nav-toggle {
            display: block;
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1051;
            border-radius: 5px;
            font-size: 1.2rem;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #2c3e50;
            color: white;
            overflow-y: auto;
            z-index: 1050;
            transform: translateX(-280px);
            transition: transform 0.3s ease;
            padding-top: 80px;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            border-bottom: 1px solid #34495e;
        }

        .sidebar a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .sidebar a:hover {
            background: #34495e;
            padding-left: 30px;
            color: white;
        }

        .sidebar a.active {
            background: #667eea;
            border-left: 4px solid #764ba2;
        }

        /* Main Content */
        .main-content {
            margin-left: 0;
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .main-content.shifted {
            margin-left: 280px;
        }

        .section {
            margin-bottom: 3rem;
            scroll-margin-top: 100px;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem 0;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        .section h4 {
            color: #555;
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
        }

        .section h5 {
            color: #666;
            font-size: 1.1rem;
            margin: 0.8rem 0 0.4rem 0;
        }

        /* Code Blocks */
        pre {
            background: #2d3748 !important;
            border-radius: 8px;
            margin: 1rem 0;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
        }

        .inline-code {
            background: #f1f5f9;
            color: #e53e3e;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .feature-card h4 {
            color: #667eea;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Relationship Cards */
        .relationship-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-left: 5px solid #667eea;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .relationship-card h4 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .example-section {
            background: #fff;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid #e2e8f0;
        }

        /* Lists */
        ul, ol {
            padding-left: 2rem;
            margin: 1rem 0;
        }

        li {
            margin: 0.5rem 0;
        }

        /* Badges */
        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 2px;
        }

        .badge.new { background: #4ecdc4; }
        .badge.advanced { background: #feca57; color: #333; }
        .badge.important { background: #ff7675; }
        .badge.relationship { background: #764ba2; }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert.info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1565c0;
        }

        .alert.warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #ef6c00;
        }

        .alert.success {
            background: #e8f5e8;
            border-color: #4CAF50;
            color: #2e7d32;
        }

        .alert.danger {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }

        /* Progress Bar */
        .progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(102, 126, 234, 0.3);
            z-index: 1002;
        }

        .progress-bar {
            height: 100%;
            background: #667eea;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Back to Top */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #667eea;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        /* Search */
        .search-container {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            border-color: #667eea;
        }

        /* Mobile First Responsive Design */
        @media (max-width: 576px) {
            * {
                max-width: 100%;
                word-wrap: break-word;
            }

            .header {
                padding: 1.5rem 1rem;
                width: 100%;
                overflow-x: hidden;
            }

            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.3rem;
                word-wrap: break-word;
            }

            .header p {
                font-size: 0.9rem;
                word-wrap: break-word;
            }

            .nav-toggle {
                top: 15px;
                left: 15px;
                padding: 8px 12px;
                font-size: 1rem;
            }

            .sidebar {
                width: 100vw;
                transform: translateX(-100%);
                max-width: 100vw;
            }

            .main-content {
                padding: 0.75rem;
                padding-top: 70px;
                margin-left: 0;
                width: 100%;
                max-width: 100vw;
                overflow-x: hidden;
            }

            .section {
                padding: 1rem;
                margin-bottom: 1.5rem;
                border-radius: 8px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                width: 100%;
                max-width: 100%;
                overflow-x: hidden;
            }

            .section h2 {
                font-size: 1.25rem;
                margin-bottom: 0.75rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .section h3 {
                font-size: 1.1rem;
                margin: 0.75rem 0 0.5rem 0;
                padding-left: 6px;
                border-left-width: 3px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .section h4 {
                font-size: 1rem;
                margin: 0.5rem 0 0.4rem 0;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .relationship-card {
                padding: 1rem;
                margin: 1rem 0;
                border-left-width: 4px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
                margin: 1rem 0;
            }

            .feature-card {
                padding: 0.75rem;
                border-radius: 8px;
            }
        }

        @media (min-width: 769px) {
            .nav-toggle {
                display: none;
            }

            .sidebar {
                transform: translateX(0);
                position: fixed;
            }

            .main-content {
                margin-left: 280px;
                padding: 2rem;
            }

            .overlay {
                display: none !important;
            }
        }

        /* Overlay for mobile sidebar */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* Syntax highlighting improvements */
        pre[class*="language-"] {
            background: #1a202c !important;
            color: #e2e8f0;
        }

        .token.comment { color: #718096; }
        .token.string { color: #68d391; }
        .token.number { color: #fbb6ce; }
        .token.keyword { color: #63b3ed; }
        .token.function { color: #f6e05e; }
        .token.operator { color: #ed8936; }

        /* Copy button styles */
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .copy-btn:hover {
            opacity: 1;
        }

        /* Database diagram styles */
        .db-diagram {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            font-family: monospace;
        }

        .db-table {
            background: white;
            border: 2px solid #2c3e50;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem;
            display: inline-block;
            min-width: 200px;
        }

        .db-table h5 {
            background: #2c3e50;
            color: white;
            margin: -1rem -1rem 0.5rem -1rem;
            padding: 0.5rem;
            border-radius: 6px 6px 0 0;
        }

        .db-field {
            text-align: left;
            padding: 0.2rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .db-field:last-child {
            border-bottom: none;
        }

        .primary-key {
            color: #667eea;
            font-weight: bold;
        }

        .foreign-key {
            color: #764ba2;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- Progress Bar -->
    <div class="progress">
        <div class="progress-bar"></div>
    </div>

    <!-- Navigation Toggle -->
    <button class="nav-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="search-container">
            <input type="text" class="search-box" placeholder="Search relationships..." onkeyup="searchContent(this.value)">
        </div>
        <ul>
            <li><a href="#introduction" onclick="closeSidebar()"><i class="fas fa-info-circle"></i> Introduction</a></li>
            <li><a href="#what-are-relationships" onclick="closeSidebar()"><i class="fas fa-question-circle"></i> What are Relationships</a></li>
            <li><a href="#why-use-relationships" onclick="closeSidebar()"><i class="fas fa-lightbulb"></i> Why Use Relationships</a></li>
            <li><a href="#how-to-use" onclick="closeSidebar()"><i class="fas fa-tools"></i> How to Use</a></li>
            <li><a href="#one-to-one" onclick="closeSidebar()"><i class="fas fa-link"></i> One to One</a></li>
            <li><a href="#one-to-many" onclick="closeSidebar()"><i class="fas fa-share-alt"></i> One to Many</a></li>
            <li><a href="#many-to-many" onclick="closeSidebar()"><i class="fas fa-project-diagram"></i> Many to Many</a></li>
            <li><a href="#has-one-through" onclick="closeSidebar()"><i class="fas fa-arrow-right"></i> Has One Through</a></li>
            <li><a href="#has-many-through" onclick="closeSidebar()"><i class="fas fa-arrows-alt-h"></i> Has Many Through</a></li>
            <li><a href="#polymorphic-one-to-one" onclick="closeSidebar()"><i class="fas fa-shapes"></i> Polymorphic One-to-One</a></li>
            <li><a href="#polymorphic-one-to-many" onclick="closeSidebar()"><i class="fas fa-sitemap"></i> Polymorphic One-to-Many</a></li>
            <li><a href="#polymorphic-many-to-many" onclick="closeSidebar()"><i class="fas fa-network-wired"></i> Polymorphic Many-to-Many</a></li>
            <li><a href="#eager-loading" onclick="closeSidebar()"><i class="fas fa-rocket"></i> Eager Loading</a></li>
            <li><a href="#lazy-loading" onclick="closeSidebar()"><i class="fas fa-hourglass-half"></i> Lazy Loading</a></li>
            <li><a href="#relationship-methods" onclick="closeSidebar()"><i class="fas fa-cogs"></i> Relationship Methods</a></li>
            <li><a href="#best-practices" onclick="closeSidebar()"><i class="fas fa-star"></i> Best Practices</a></li>
            <li><a href="#troubleshooting" onclick="closeSidebar()"><i class="fas fa-bug"></i> Troubleshooting</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fab fa-laravel"></i> Laravel Eloquent Relationships</h1>
            <p>Complete Guide to Database Relationships in Laravel</p>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            
            <!-- Introduction -->
            <section class="section" id="introduction">
                <h2><i class="fas fa-info-circle"></i> Introduction to Eloquent Relationships</h2>
                <div class="alert info">
                    <strong>Welcome!</strong> This comprehensive guide covers all aspects of Laravel Eloquent relationships. Learn how to define, use, and optimize database relationships in your Laravel applications.
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-database"></i> Database Relationships</h4>
                        <p>Learn how to connect and relate different database tables using Eloquent ORM.</p>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-code"></i> Eloquent Magic</h4>
                        <p>Discover the power of Eloquent's intuitive API for handling complex relationships.</p>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-performance"></i> Performance</h4>
                        <p>Optimize your queries with eager loading and avoid the N+1 query problem.</p>
                    </div>
                </div>
            </section>

            <!-- What are Relationships -->
            <section class="section" id="what-are-relationships">
                <h2><i class="fas fa-question-circle"></i> What are Relationships?</h2>
                
                <div class="alert success">
                    <strong>Database Relationships</strong> define how different tables in your database are connected to each other. They allow you to link records from one table to records in another table, creating meaningful connections between your data.
                </div>

                <h3>Key Concepts</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-key"></i> Primary Key</h4>
                        <p>A unique identifier for each record in a table (usually 'id').</p>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-link"></i> Foreign Key</h4>
                        <p>A field that links to the primary key of another table.</p>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-table"></i> Pivot Table</h4>
                        <p>An intermediate table that stores relationships between two other tables.</p>
                    </div>
                    <div class="feature-card">
                        <h4><i class="fas fa-shapes"></i> Polymorphic</h4>
                        <p>A relationship where a model can belong to multiple other model types.</p>
                    </div>
                </div>

                <h3>Relationship Types Overview</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Relationship Type</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>One to One</strong></td>
                            <td>One record relates to exactly one record in another table</td>
                            <td>User ↔ Profile</td>
                        </tr>
                        <tr>
                            <td><strong>One to Many</strong></td>
                            <td>One record relates to multiple records in another table</td>
                            <td>User → Posts</td>
                        </tr>
                        <tr>
                            <td><strong>Many to Many</strong></td>
                            <td>Multiple records relate to multiple records via pivot table</td>
                            <td>Users ↔ Roles</td>
                        </tr>
                        <tr>
                            <td><strong>Has One Through</strong></td>
                            <td>One-to-one relationship through an intermediate model</td>
                            <td>User → Profile → Avatar</td>
                        </tr>
                        <tr>
                            <td><strong>Has Many Through</strong></td>
                            <td>One-to-many relationship through an intermediate model</td>
                            <td>Country → Users → Posts</td>
                        </tr>
                        <tr>
                            <td><strong>Polymorphic</strong></td>
                            <td>A model can belong to multiple other model types</td>
                            <td>Comments on Posts and Videos</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Why Use Relationships -->
            <section class="section" id="why-use-relationships">
                <h2><i class="fas fa-lightbulb"></i> Why Use Relationships?</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-benefits"></i> Key Benefits</h4>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4><i class="fas fa-database"></i> Data Integrity</h4>
                            <ul>
                                <li>Maintain referential integrity</li>
                                <li>Prevent orphaned records</li>
                                <li>Enforce business rules at database level</li>
                                <li>Automatic constraint checking</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="fas fa-recycle"></i> Data Normalization</h4>
                            <ul>
                                <li>Eliminate data duplication</li>
                                <li>Reduce storage requirements</li>
                                <li>Ensure data consistency</li>
                                <li>Easier data maintenance</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="fas fa-search"></i> Efficient Queries</h4>
                            <ul>
                                <li>Join related data efficiently</li>
                                <li>Eager loading prevents N+1 queries</li>
                                <li>Database-level optimizations</li>
                                <li>Better query performance</li>
                            </ul>
                        </div>
                        
                        <div class="feature-card">
                            <h4><i class="fas fa-code"></i> Clean Code</h4>
                            <ul>
                                <li>Intuitive API for data access</li>
                                <li>Readable and maintainable code</li>
                                <li>Automatic relationship loading</li>
                                <li>Simplified data manipulation</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <h3>Without Relationships vs With Relationships</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-times-circle"></i> Without Relationships</h4>
                        <pre><code class="language-php">// Inefficient and error-prone
$user = User::find(1);
$posts = Post::where('user_id', $user->id)->get();

foreach ($posts as $post) {
    $comments = Comment::where('post_id', $post->id)->get();
    // N+1 query problem!
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-check-circle"></i> With Relationships</h4>
                        <pre><code class="language-php">// Clean, efficient, and readable
$user = User::with('posts.comments')->find(1);

foreach ($user->posts as $post) {
    foreach ($post->comments as $comment) {
        // All data loaded with just 3 queries!
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- How to Use Relationships -->
            <section class="section" id="how-to-use">
                <h2><i class="fas fa-tools"></i> How to Use Relationships</h2>
                
                <h3>Basic Setup Steps</h3>
                <div class="alert info">
                    Follow these steps to set up relationships in your Laravel application.
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-step-forward"></i> Step 1: Create Migrations</h4>
                        <pre><code class="language-bash"># Create migration with foreign key
php artisan make:migration create_posts_table

# Add foreign key constraint
$table->foreignId('user_id')->constrained();</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-step-forward"></i> Step 2: Define Models</h4>
                        <pre><code class="language-php">// Create models
php artisan make:model Post
php artisan make:model User</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-step-forward"></i> Step 3: Define Relationships</h4>
                        <pre><code class="language-php">// In User model
public function posts()
{
    return $this->hasMany(Post::class);
}

// In Post model  
public function user()
{
    return $this->belongsTo(User::class);
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-step-forward"></i> Step 4: Use Relationships</h4>
                        <pre><code class="language-php">// Access related data
$user = User::find(1);
$posts = $user->posts;

$post = Post::find(1);
$author = $post->user;</code></pre>
                    </div>
                </div>

                <h3>Naming Conventions</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Convention</th>
                            <th>Example</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Foreign Key</strong></td>
                            <td><code>user_id</code></td>
                            <td>Singular model name + '_id'</td>
                        </tr>
                        <tr>
                            <td><strong>Pivot Table</strong></td>
                            <td><code>post_tag</code></td>
                            <td>Alphabetically ordered singular model names</td>
                        </tr>
                        <tr>
                            <td><strong>Relationship Method</strong></td>
                            <td><code>posts()</code></td>
                            <td>Plural for hasMany, singular for belongsTo</td>
                        </tr>
                        <tr>
                            <td><strong>Polymorphic Type</strong></td>
                            <td><code>commentable_type</code></td>
                            <td>Relationship name + '_type'</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- One to One Relationship -->
            <section class="section" id="one-to-one">
                <h2><i class="fas fa-link"></i> One to One Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>One-to-One</strong> relationship exists when one record in a table is associated with exactly one record in another table, and vice versa.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>users</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 2rem 1rem; font-size: 2rem;">↔</div>
                    <div class="db-table">
                        <h5>profiles</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">user_id</span> - Foreign Key</div>
                        <div class="db-field">bio</div>
                        <div class="db-field">avatar</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Users Migration</h5>
                    <pre><code class="language-php">// Create users migration
php artisan make:migration create_users_table

public function up()
{
    Schema::create('users', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->string('email')->unique();
        $table->timestamp('email_verified_at')->nullable();
        $table->string('password');
        $table->rememberToken();
        $table->timestamps();
    });
}</code></pre>

                    <h5>Profiles Migration</h5>
                    <pre><code class="language-php">// Create profiles migration
php artisan make:migration create_profiles_table

public function up()
{
    Schema::create('profiles', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->text('bio')->nullable();
        $table->string('avatar')->nullable();
        $table->date('birth_date')->nullable();
        $table->string('website')->nullable();
        $table->timestamps();
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-user"></i> User Model</h4>
                        <pre><code class="language-php">// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name', 'email', 'password'
    ];

    /**
     * Get the user's profile.
     */
    public function profile()
    {
        return $this->hasOne(Profile::class);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-id-card"></i> Profile Model</h4>
                        <pre><code class="language-php">// app/Models/Profile.php
class Profile extends Model
{
    protected $fillable = [
        'user_id', 'bio', 'avatar', 
        'birth_date', 'website'
    ];

    protected $dates = ['birth_date'];

    /**
     * Get the user that owns the profile.
     */
    public function user()
    {
        return $this->belongsTo(User::class);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Records</h5>
                    <pre><code class="language-php">// Create user with profile
$user = User::create([
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'password' => bcrypt('password')
]);

// Create profile for user
$user->profile()->create([
    'bio' => 'Laravel Developer',
    'avatar' => 'avatar.jpg',
    'website' => 'https://johndoe.com'
]);

// Or create profile directly
Profile::create([
    'user_id' => $user->id,
    'bio' => 'Laravel Developer',
    'avatar' => 'avatar.jpg'
]);</code></pre>

                    <h5>Retrieving Related Data</h5>
                    <pre><code class="language-php">// Get user with profile
$user = User::with('profile')->find(1);
echo $user->profile->bio; // Laravel Developer

// Get profile with user
$profile = Profile::with('user')->find(1);
echo $profile->user->name; // John Doe

// Check if relationship exists
if ($user->profile) {
    echo $user->profile->bio;
}

// Using dynamic properties
$userBio = User::find(1)->profile->bio;</code></pre>

                    <h5>Updating Related Data</h5>
                    <pre><code class="language-php">// Update profile through user
$user = User::find(1);
$user->profile->update([
    'bio' => 'Senior Laravel Developer',
    'website' => 'https://newwebsite.com'
]);

// Create or update profile
$user->profile()->updateOrCreate(
    ['user_id' => $user->id],
    ['bio' => 'Full Stack Developer']
);</code></pre>
                </div>

                <h3>Advanced Options</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-cog"></i> Custom Foreign Key</h4>
                        <pre><code class="language-php">// Custom foreign key name
public function profile()
{
    return $this->hasOne(
        Profile::class, 
        'owner_id' // custom foreign key
    );
}

// Inverse with custom keys
public function user()
{
    return $this->belongsTo(
        User::class,
        'owner_id', // foreign key
        'id'        // owner key  
    );
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-database"></i> Different Table</h4>
                        <pre><code class="language-php">// Specify different table
public function profile()
{
    return $this->hasOne(Profile::class)
                ->from('user_profiles');
}

// Or in model
class Profile extends Model
{
    protected $table = 'user_profiles';
}</code></pre>
                    </div>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common One-to-One Relationships:</strong>
                    <ul>
                        <li><strong>User ↔ Profile:</strong> User account and detailed profile information</li>
                        <li><strong>User ↔ Address:</strong> User and their primary address</li>
                        <li><strong>Product ↔ ProductDetail:</strong> Product and detailed specifications</li>
                        <li><strong>Order ↔ Invoice:</strong> Order and its corresponding invoice</li>
                        <li><strong>User ↔ Subscription:</strong> User and their active subscription</li>
                    </ul>
                </div>
            </section>

            <!-- One to Many Relationship -->
            <section class="section" id="one-to-many">
                <h2><i class="fas fa-share-alt"></i> One to Many Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>One-to-Many</strong> relationship exists when one record in a table can be associated with multiple records in another table, but each record in the second table is associated with only one record in the first table.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>users</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 2rem 1rem; font-size: 2rem;">→</div>
                    <div class="db-table">
                        <h5>posts</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">user_id</span> - Foreign Key</div>
                        <div class="db-field">title</div>
                        <div class="db-field">content</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Posts Migration</h5>
                    <pre><code class="language-php">// Create posts migration
php artisan make:migration create_posts_table

public function up()
{
    Schema::create('posts', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->string('title');
        $table->text('content');
        $table->string('slug')->unique();
        $table->boolean('published')->default(false);
        $table->timestamp('published_at')->nullable();
        $table->timestamps();
    });
}</code></pre>

                    <h5>Comments Migration</h5>
                    <pre><code class="language-php">// Create comments migration
php artisan make:migration create_comments_table

public function up()
{
    Schema::create('comments', function (Blueprint $table) {
        $table->id();
        $table->foreignId('post_id')->constrained()->onDelete('cascade');
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->text('content');
        $table->boolean('approved')->default(false);
        $table->timestamps();
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-user"></i> User Model</h4>
                        <pre><code class="language-php">// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name', 'email', 'password'
    ];

    /**
     * Get all posts by the user.
     */
    public function posts()
    {
        return $this->hasMany(Post::class);
    }

    /**
     * Get all comments by the user.
     */
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }

    /**
     * Get published posts only.
     */
    public function publishedPosts()
    {
        return $this->hasMany(Post::class)
                    ->where('published', true);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-file-alt"></i> Post Model</h4>
                        <pre><code class="language-php">// app/Models/Post.php
class Post extends Model
{
    protected $fillable = [
        'user_id', 'title', 'content', 
        'slug', 'published', 'published_at'
    ];

    protected $dates = ['published_at'];

    protected $casts = [
        'published' => 'boolean'
    ];

    /**
     * Get the user that owns the post.
     */
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    /**
     * Get all comments for the post.
     */
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Records</h5>
                    <pre><code class="language-php">// Create posts for a user
$user = User::find(1);

$post = $user->posts()->create([
    'title' => 'My First Post',
    'content' => 'This is the content of my first post.',
    'slug' => 'my-first-post',
    'published' => true,
    'published_at' => now()
]);

// Create multiple posts
$user->posts()->createMany([
    [
        'title' => 'Second Post',
        'content' => 'Content for second post',
        'slug' => 'second-post'
    ],
    [
        'title' => 'Third Post',  
        'content' => 'Content for third post',
        'slug' => 'third-post'
    ]
]);

// Associate existing post with user
$post = Post::find(1);
$user->posts()->save($post);</code></pre>

                    <h5>Retrieving Related Data</h5>
                    <pre><code class="language-php">// Get all posts by a user
$user = User::find(1);
$posts = $user->posts; // Collection of Post models

// Get posts with conditions
$publishedPosts = $user->posts()
                      ->where('published', true)
                      ->orderBy('published_at', 'desc')
                      ->get();

// Count related records
$postCount = $user->posts()->count();
$publishedCount = $user->posts()
                      ->where('published', true)
                      ->count();

// Get latest posts
$latestPosts = $user->posts()
                   ->latest('published_at')
                   ->take(5)
                   ->get();

// Check if user has posts
if ($user->posts->isNotEmpty()) {
    echo "User has posts!";
}</code></pre>

                    <h5>Querying Relationships</h5>
                    <pre><code class="language-php">// Users with posts
$usersWithPosts = User::has('posts')->get();

// Users with at least 5 posts
$prolificUsers = User::has('posts', '>=', 5)->get();

// Users with published posts
$publishersWithPosts = User::whereHas('posts', function ($query) {
    $query->where('published', true);
})->get();

// Users without posts
$usersWithoutPosts = User::doesntHave('posts')->get();

// Posts with comments count
$postsWithCommentCount = Post::withCount('comments')->get();

foreach ($postsWithCommentCount as $post) {
    echo $post->title . ' has ' . $post->comments_count . ' comments';
}</code></pre>
                </div>

                <h3>Advanced Usage</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-filter"></i> Conditional Relationships</h4>
                        <pre><code class="language-php">// Published posts only
public function publishedPosts()
{
    return $this->hasMany(Post::class)
                ->where('published', true)
                ->orderBy('published_at', 'desc');
}

// Recent posts (last 30 days)
public function recentPosts()
{
    return $this->hasMany(Post::class)
                ->where('created_at', '>=', 
                        now()->subDays(30));
}

// Popular posts (with many comments)
public function popularPosts()
{
    return $this->hasMany(Post::class)
                ->withCount('comments')
                ->orderBy('comments_count', 'desc');
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-tools"></i> Custom Foreign Keys</h4>
                        <pre><code class="language-php">// Custom foreign key
public function posts()
{
    return $this->hasMany(
        Post::class,
        'author_id' // custom foreign key
    );
}

// Custom local key
public function posts()
{
    return $this->hasMany(
        Post::class,
        'user_id',  // foreign key
        'user_uuid' // local key
    );
}</code></pre>
                    </div>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common One-to-Many Relationships:</strong>
                    <ul>
                        <li><strong>User → Posts:</strong> User can write multiple blog posts</li>
                        <li><strong>Category → Products:</strong> Category contains multiple products</li>
                        <li><strong>Customer → Orders:</strong> Customer can place multiple orders</li>
                        <li><strong>Post → Comments:</strong> Post can have multiple comments</li>
                        <li><strong>Department → Employees:</strong> Department has multiple employees</li>
                        <li><strong>Author → Books:</strong> Author can write multiple books</li>
                    </ul>
                </div>
            </section>

            <!-- Many to Many Relationship -->
            <section class="section" id="many-to-many">
                <h2><i class="fas fa-project-diagram"></i> Many to Many Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Many-to-Many</strong> relationship exists when multiple records in one table can be associated with multiple records in another table. This requires a pivot (intermediate) table to store the relationships.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>users</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↔</div>
                    <div class="db-table">
                        <h5>role_user (pivot)</h5>
                        <div class="db-field"><span class="foreign-key">user_id</span></div>
                        <div class="db-field"><span class="foreign-key">role_id</span></div>
                        <div class="db-field">assigned_at</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↔</div>
                    <div class="db-table">
                        <h5>roles</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">guard_name</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Roles Migration</h5>
                    <pre><code class="language-php">// Create roles migration
php artisan make:migration create_roles_table

public function up()
{
    Schema::create('roles', function (Blueprint $table) {
        $table->id();
        $table->string('name')->unique();
        $table->string('guard_name')->default('web');
        $table->text('description')->nullable();
        $table->timestamps();
    });
}</code></pre>

                    <h5>Pivot Table Migration</h5>
                    <pre><code class="language-php">// Create pivot table migration
php artisan make:migration create_role_user_table

public function up()
{
    Schema::create('role_user', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->foreignId('role_id')->constrained()->onDelete('cascade');
        $table->timestamp('assigned_at')->default(now());
        $table->foreignId('assigned_by')->nullable()->constrained('users');
        $table->timestamps();
        
        // Prevent duplicate assignments
        $table->unique(['user_id', 'role_id']);
    });
}</code></pre>

                    <h5>Tags Example Migration</h5>
                    <pre><code class="language-php">// Create tags migration
php artisan make:migration create_tags_table

public function up()
{
    Schema::create('tags', function (Blueprint $table) {
        $table->id();
        $table->string('name')->unique();
        $table->string('slug')->unique();
        $table->string('color')->default('#6366f1');
        $table->timestamps();
    });
}

// Create post_tag pivot table
php artisan make:migration create_post_tag_table

public function up()
{
    Schema::create('post_tag', function (Blueprint $table) {
        $table->id();
        $table->foreignId('post_id')->constrained()->onDelete('cascade');
        $table->foreignId('tag_id')->constrained()->onDelete('cascade');
        $table->integer('order')->default(0);
        $table->timestamps();
        
        $table->unique(['post_id', 'tag_id']);
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-user"></i> User Model</h4>
                        <pre><code class="language-php">// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name', 'email', 'password'
    ];

    /**
     * Get all roles assigned to the user.
     */
    public function roles()
    {
        return $this->belongsToMany(Role::class)
                    ->withTimestamps()
                    ->withPivot('assigned_at', 'assigned_by');
    }

    /**
     * Check if user has a specific role.
     */
    public function hasRole($roleName)
    {
        return $this->roles()
                   ->where('name', $roleName)
                   ->exists();
    }

    /**
     * Assign role to user.
     */
    public function assignRole($role)
    {
        return $this->roles()->attach($role, [
            'assigned_at' => now(),
            'assigned_by' => auth()->id()
        ]);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-user-shield"></i> Role Model</h4>
                        <pre><code class="language-php">// app/Models/Role.php
class Role extends Model
{
    protected $fillable = [
        'name', 'guard_name', 'description'
    ];

    /**
     * Get all users with this role.
     */
    public function users()
    {
        return $this->belongsToMany(User::class)
                    ->withTimestamps()
                    ->withPivot('assigned_at', 'assigned_by');
    }

    /**
     * Get users count for this role.
     */
    public function getUsersCountAttribute()
    {
        return $this->users()->count();
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Attaching Relationships</h5>
                    <pre><code class="language-php">$user = User::find(1);
$role = Role::find(1);

// Attach single role
$user->roles()->attach($role);

// Attach role by ID
$user->roles()->attach(1);

// Attach multiple roles
$user->roles()->attach([1, 2, 3]);

// Attach with pivot data
$user->roles()->attach(1, [
    'assigned_at' => now(),
    'assigned_by' => auth()->id()
]);

// Attach multiple with different pivot data
$user->roles()->attach([
    1 => ['assigned_at' => now()],
    2 => ['assigned_at' => now()->subDay()]
]);</code></pre>

                    <h5>Detaching Relationships</h5>
                    <pre><code class="language-php">// Detach specific role
$user->roles()->detach(1);

// Detach multiple roles
$user->roles()->detach([1, 2, 3]);

// Detach all roles
$user->roles()->detach();

// Sync roles (add new, remove missing)
$user->roles()->sync([1, 2, 3]);

// Sync without detaching existing
$user->roles()->syncWithoutDetaching([4, 5]);</code></pre>

                    <h5>Updating Pivot Data</h5>
                    <pre><code class="language-php">// Update pivot data
$user->roles()->updateExistingPivot(1, [
    'assigned_at' => now(),
    'assigned_by' => 2
]);

// Toggle relationship
$user->roles()->toggle([1, 2, 3]);

// Update or attach
$user->roles()->syncWithPivotValues([1, 2], [
    'assigned_by' => auth()->id()
]);</code></pre>
                </div>

                <h3>Retrieving Related Data</h3>
                <div class="example-section">
                    <h5>Basic Retrieval</h5>
                    <pre><code class="language-php">// Get all roles for a user
$user = User::with('roles')->find(1);
foreach ($user->roles as $role) {
    echo $role->name;
    
    // Access pivot data
    echo $role->pivot->assigned_at;
    echo $role->pivot->assigned_by;
}

// Get users with specific role
$adminRole = Role::with('users')->where('name', 'admin')->first();
foreach ($adminRole->users as $user) {
    echo $user->name;
}</code></pre>

                    <h5>Querying Relationships</h5>
                    <pre><code class="language-php">// Users with admin role
$admins = User::whereHas('roles', function ($query) {
    $query->where('name', 'admin');
})->get();

// Users with multiple roles
$usersWithRoles = User::has('roles', '>', 1)->get();

// Roles with users count
$rolesWithCount = Role::withCount('users')->get();

// Filter by pivot data
$recentlyAssigned = User::whereHas('roles', function ($query) {
    $query->where('role_user.assigned_at', '>=', now()->subWeek());
})->get();</code></pre>

                    <h5>Accessing Pivot Model</h5>
                    <pre><code class="language-php">// Create custom pivot model
class RoleUser extends Pivot
{
    protected $table = 'role_user';
    
    protected $fillable = [
        'assigned_at', 'assigned_by'
    ];
    
    protected $dates = ['assigned_at'];
    
    public function assignedBy()
    {
        return $this->belongsTo(User::class, 'assigned_by');
    }
}

// Use custom pivot model
public function roles()
{
    return $this->belongsToMany(Role::class)
                ->using(RoleUser::class)
                ->withTimestamps()
                ->withPivot('assigned_at', 'assigned_by');
}

// Access pivot relationships
$user = User::with('roles.pivot.assignedBy')->find(1);
foreach ($user->roles as $role) {
    echo "Assigned by: " . $role->pivot->assignedBy->name;
}</code></pre>
                </div>

                <h3>Advanced Examples</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-tags"></i> Post Tags Example</h4>
                        <pre><code class="language-php">// Post model
class Post extends Model
{
    public function tags()
    {
        return $this->belongsToMany(Tag::class)
                    ->withTimestamps()
                    ->withPivot('order')
                    ->orderBy('pivot_order');
    }
}

// Tag model
class Tag extends Model
{
    public function posts()
    {
        return $this->belongsToMany(Post::class)
                    ->withTimestamps()
                    ->withPivot('order');
    }
}

// Usage
$post = Post::find(1);
$post->tags()->attach([1, 2, 3], ['order' => 1]);

// Get posts by tag
$tag = Tag::find(1);
$posts = $tag->posts()->orderBy('created_at', 'desc')->get();</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-shopping-cart"></i> Product Categories</h4>
                        <pre><code class="language-php">// Product model
class Product extends Model
{
    public function categories()
    {
        return $this->belongsToMany(Category::class)
                    ->withTimestamps();
    }
}

// Category model  
class Category extends Model
{
    public function products()
    {
        return $this->belongsToMany(Product::class)
                    ->withTimestamps();
    }
    
    public function featuredProducts()
    {
        return $this->belongsToMany(Product::class)
                    ->where('featured', true);
    }
}

// Usage
$category = Category::find(1);
$products = $category->products()
                    ->where('status', 'active')
                    ->orderBy('name')
                    ->get();</code></pre>
                    </div>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Many-to-Many Relationships:</strong>
                    <ul>
                        <li><strong>Users ↔ Roles:</strong> Users can have multiple roles, roles can be assigned to multiple users</li>
                        <li><strong>Posts ↔ Tags:</strong> Posts can have multiple tags, tags can be used on multiple posts</li>
                        <li><strong>Products ↔ Categories:</strong> Products can belong to multiple categories</li>
                        <li><strong>Students ↔ Courses:</strong> Students can enroll in multiple courses</li>
                        <li><strong>Movies ↔ Genres:</strong> Movies can have multiple genres</li>
                        <li><strong>Users ↔ Groups:</strong> Users can be members of multiple groups</li>
                    </ul>
                </div>
            </section>

            <!-- Has One Through -->
            <section class="section" id="has-one-through">
                <h2><i class="fas fa-arrow-right"></i> Has One Through Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Has One Through</strong> relationship provides a convenient way to access distant relations via an intermediate relation. It defines a one-to-one relationship with another model through a third model.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>mechanics</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">→</div>
                    <div class="db-table">
                        <h5>cars</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">mechanic_id</span></div>
                        <div class="db-field">model</div>
                        <div class="db-field">make</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">→</div>
                    <div class="db-table">
                        <h5>owners</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">car_id</span></div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Mechanics Migration</h5>
                    <pre><code class="language-php">// Create mechanics migration
php artisan make:migration create_mechanics_table

public function up()
{
    Schema::create('mechanics', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->string('email')->unique();
        $table->string('specialization')->nullable();
        $table->integer('years_experience')->default(0);
        $table->timestamps();
    });
}</code></pre>

                    <h5>Cars Migration</h5>
                    <pre><code class="language-php">// Create cars migration
php artisan make:migration create_cars_table

public function up()
{
    Schema::create('cars', function (Blueprint $table) {
        $table->id();
        $table->foreignId('mechanic_id')->constrained()->onDelete('cascade');
        $table->string('make');
        $table->string('model');
        $table->integer('year');
        $table->string('vin')->unique();
        $table->timestamps();
    });
}</code></pre>

                    <h5>Owners Migration</h5>
                    <pre><code class="language-php">// Create owners migration
php artisan make:migration create_owners_table

public function up()
{
    Schema::create('owners', function (Blueprint $table) {
        $table->id();
        $table->foreignId('car_id')->constrained()->onDelete('cascade');
        $table->string('name');
        $table->string('email');
        $table->string('phone')->nullable();
        $table->text('address')->nullable();
        $table->timestamps();
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-tools"></i> Mechanic Model</h4>
                        <pre><code class="language-php">// app/Models/Mechanic.php
class Mechanic extends Model
{
    protected $fillable = [
        'name', 'email', 'specialization', 'years_experience'
    ];

    /**
     * Get the car assigned to the mechanic.
     */
    public function car()
    {
        return $this->hasOne(Car::class);
    }

    /**
     * Get the car owner through the car.
     */
    public function carOwner()
    {
        return $this->hasOneThrough(
            Owner::class,    // Final model
            Car::class,      // Intermediate model
            'mechanic_id',   // Foreign key on cars table
            'car_id',        // Foreign key on owners table
            'id',            // Local key on mechanics table
            'id'             // Local key on cars table
        );
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-car"></i> Car Model</h4>
                        <pre><code class="language-php">// app/Models/Car.php
class Car extends Model
{
    protected $fillable = [
        'mechanic_id', 'make', 'model', 'year', 'vin'
    ];

    /**
     * Get the mechanic assigned to the car.
     */
    public function mechanic()
    {
        return $this->belongsTo(Mechanic::class);
    }

    /**
     * Get the owner of the car.
     */
    public function owner()
    {
        return $this->hasOne(Owner::class);
    }
}</code></pre>
                    </div>
                </div>

                <div class="feature-card">
                    <h4><i class="fas fa-user"></i> Owner Model</h4>
                    <pre><code class="language-php">// app/Models/Owner.php
class Owner extends Model
{
    protected $fillable = [
        'car_id', 'name', 'email', 'phone', 'address'
    ];

    /**
     * Get the car that belongs to the owner.
     */
    public function car()
    {
        return $this->belongsTo(Car::class);
    }

    /**
     * Get the mechanic through the car.
     */
    public function mechanic()
    {
        return $this->hasOneThrough(
            Mechanic::class,  // Final model
            Car::class,       // Intermediate model
            'id',             // Foreign key on cars table (owner -> car)
            'id',             // Foreign key on mechanics table (car -> mechanic)
            'car_id',         // Local key on owners table
            'mechanic_id'     // Local key on cars table
        );
    }
}</code></pre>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Records</h5>
                    <pre><code class="language-php">// Create mechanic
$mechanic = Mechanic::create([
    'name' => 'John Smith',
    'email' => 'john@garage.com',
    'specialization' => 'BMW',
    'years_experience' => 10
]);

// Create car for mechanic
$car = $mechanic->car()->create([
    'make' => 'BMW',
    'model' => 'X5',
    'year' => 2022,
    'vin' => '1234567890'
]);

// Create owner for car
$owner = $car->owner()->create([
    'name' => 'Jane Doe',
    'email' => 'jane@example.com',
    'phone' => '555-1234',
    'address' => '123 Main St'
]);</code></pre>

                    <h5>Retrieving Related Data</h5>
                    <pre><code class="language-php">// Get mechanic with car owner
$mechanic = Mechanic::with('carOwner')->find(1);

if ($mechanic->carOwner) {
    echo "Mechanic: " . $mechanic->name;
    echo "Car Owner: " . $mechanic->carOwner->name;
    echo "Owner Email: " . $mechanic->carOwner->email;
}

// Get all mechanics with their car owners
$mechanicsWithOwners = Mechanic::with('carOwner')->get();

foreach ($mechanicsWithOwners as $mechanic) {
    echo $mechanic->name . " -> ";
    echo $mechanic->carOwner ? $mechanic->carOwner->name : 'No owner';
}</code></pre>

                    <h5>Querying Through Relationships</h5>
                    <pre><code class="language-php">// Mechanics who have car owners
$mechanicsWithOwners = Mechanic::has('carOwner')->get();

// Mechanics with owners in specific location
$mechanicsInNYC = Mechanic::whereHas('carOwner', function ($query) {
    $query->where('address', 'like', '%New York%');
})->get();

// Count mechanics with car owners
$countWithOwners = Mechanic::has('carOwner')->count();

// Get owner through mechanic
$owner = Owner::with('mechanic')->find(1);
if ($owner->mechanic) {
    echo "Owner's mechanic: " . $owner->mechanic->name;
}</code></pre>
                </div>

                <h3>Advanced Examples</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-hospital"></i> User Profile Avatar</h4>
                        <pre><code class="language-php">// User -> Profile -> Avatar relationship
class User extends Model
{
    public function profile()
    {
        return $this->hasOne(Profile::class);
    }
    
    public function avatar()
    {
        return $this->hasOneThrough(
            Avatar::class,
            Profile::class,
            'user_id',     // Foreign key on profiles table
            'profile_id',  // Foreign key on avatars table
            'id',          // Local key on users table
            'id'           // Local key on profiles table
        );
    }
}

// Usage
$user = User::with('avatar')->find(1);
if ($user->avatar) {
    echo '<img src="' . $user->avatar->url . '" alt="Avatar">';
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-building"></i> Country Project Manager</h4>
                        <pre><code class="language-php">// Country -> Project -> Manager relationship
class Country extends Model
{
    public function projects()
    {
        return $this->hasMany(Project::class);
    }
    
    public function projectManager()
    {
        return $this->hasOneThrough(
            Manager::class,
            Project::class,
            'country_id',    // Foreign key on projects table
            'project_id',    // Foreign key on managers table
            'id',            // Local key on countries table
            'id'             // Local key on projects table
        );
    }
}

// Usage
$country = Country::with('projectManager')->find(1);
if ($country->projectManager) {
    echo $country->name . " project manager: " . $country->projectManager->name;
}</code></pre>
                    </div>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Has One Through Relationships:</strong>
                    <ul>
                        <li><strong>User → Profile → Avatar:</strong> Access user's avatar through their profile</li>
                        <li><strong>Supplier → Product → ProductDetail:</strong> Get product details through product</li>
                        <li><strong>Department → Employee → EmployeeProfile:</strong> Access employee profile through department</li>
                        <li><strong>Country → State → Capital:</strong> Get state capital through country</li>
                        <li><strong>Customer → Order → Invoice:</strong> Access invoice through order</li>
                    </ul>
                </div>
            </section>

            <!-- Has Many Through -->
            <section class="section" id="has-many-through">
                <h2><i class="fas fa-arrows-alt-h"></i> Has Many Through Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Has Many Through</strong> relationship provides a convenient way to access distant relations via an intermediate relation. It defines a one-to-many relationship with another model through a third model.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>countries</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">code</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">→</div>
                    <div class="db-table">
                        <h5>users</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">country_id</span></div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">→</div>
                    <div class="db-table">
                        <h5>posts</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">user_id</span></div>
                        <div class="db-field">title</div>
                        <div class="db-field">content</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Countries Migration</h5>
                    <pre><code class="language-php">// Create countries migration
php artisan make:migration create_countries_table

public function up()
{
    Schema::create('countries', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->string('code', 3)->unique();
        $table->string('currency', 3)->nullable();
        $table->integer('population')->nullable();
        $table->timestamps();
    });
}</code></pre>

                    <h5>Updated Users Migration</h5>
                    <pre><code class="language-php">// Update users migration to include country
php artisan make:migration add_country_id_to_users_table

public function up()
{
    Schema::table('users', function (Blueprint $table) {
        $table->foreignId('country_id')->nullable()->constrained();
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-globe"></i> Country Model</h4>
                        <pre><code class="language-php">// app/Models/Country.php
class Country extends Model
{
    protected $fillable = [
        'name', 'code', 'currency', 'population'
    ];

    /**
     * Get all users in the country.
     */
    public function users()
    {
        return $this->hasMany(User::class);
    }

    /**
     * Get all posts through users.
     */
    public function posts()
    {
        return $this->hasManyThrough(
            Post::class,     // Final model
            User::class,     // Intermediate model
            'country_id',    // Foreign key on users table
            'user_id',       // Foreign key on posts table
            'id',            // Local key on countries table
            'id'             // Local key on users table
        );
    }

    /**
     * Get published posts through users.
     */
    public function publishedPosts()
    {
        return $this->hasManyThrough(Post::class, User::class)
                    ->where('posts.published', true);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-user"></i> Updated User Model</h4>
                        <pre><code class="language-php">// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name', 'email', 'password', 'country_id'
    ];

    /**
     * Get the country of the user.
     */
    public function country()
    {
        return $this->belongsTo(Country::class);
    }

    /**
     * Get all posts by the user.
     */
    public function posts()
    {
        return $this->hasMany(Post::class);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Records</h5>
                    <pre><code class="language-php">// Create country
$usa = Country::create([
    'name' => 'United States',
    'code' => 'USA',
    'currency' => 'USD',
    'population' => 331900000
]);

// Create users in country
$user1 = $usa->users()->create([
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'password' => bcrypt('password')
]);

$user2 = $usa->users()->create([
    'name' => 'Jane Smith',
    'email' => 'jane@example.com',
    'password' => bcrypt('password')
]);

// Create posts for users
$user1->posts()->create([
    'title' => 'Laravel Tips',
    'content' => 'Here are some Laravel tips...',
    'published' => true
]);

$user2->posts()->create([
    'title' => 'PHP Best Practices',
    'content' => 'PHP best practices include...',
    'published' => true
]);</code></pre>

                    <h5>Retrieving Related Data</h5>
                    <pre><code class="language-php">// Get all posts from a country
$country = Country::with('posts')->find(1);

echo "Posts from " . $country->name . ":";
foreach ($country->posts as $post) {
    echo "- " . $post->title;
}

// Get countries with post count
$countriesWithPostCount = Country::withCount('posts')->get();

foreach ($countriesWithPostCount as $country) {
    echo $country->name . ": " . $country->posts_count . " posts";
}

// Get published posts only
$publishedPosts = $country->publishedPosts;
echo "Published posts: " . $publishedPosts->count();</code></pre>

                    <h5>Querying Through Relationships</h5>
                    <pre><code class="language-php">// Countries with posts
$countriesWithPosts = Country::has('posts')->get();

// Countries with many posts
$activeCountries = Country::has('posts', '>', 10)->get();

// Countries with published posts
$countriesWithPublishedPosts = Country::whereHas('posts', function ($query) {
    $query->where('published', true);
})->get();

// Countries with posts containing specific keywords
$countriesWithLaravelPosts = Country::whereHas('posts', function ($query) {
    $query->where('title', 'like', '%Laravel%')
          ->orWhere('content', 'like', '%Laravel%');
})->get();

// Get posts with country information
$postsWithCountry = Post::with('user.country')->get();

foreach ($postsWithCountry as $post) {
    echo $post->title . " from " . $post->user->country->name;
}</code></pre>
                </div>

                <h3>Advanced Examples</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-building"></i> Company Departments Projects</h4>
                        <pre><code class="language-php">// Company -> Department -> Project relationship
class Company extends Model
{
    public function departments()
    {
        return $this->hasMany(Department::class);
    }
    
    public function projects()
    {
        return $this->hasManyThrough(
            Project::class,
            Department::class,
            'company_id',      // Foreign key on departments table
            'department_id',   // Foreign key on projects table
            'id',              // Local key on companies table
            'id'               // Local key on departments table
        );
    }
    
    public function activeProjects()
    {
        return $this->projects()
                    ->where('projects.status', 'active');
    }
}

// Usage
$company = Company::with('projects')->find(1);
echo $company->name . " has " . $company->projects->count() . " projects";</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-school"></i> School Students Grades</h4>
                        <pre><code class="language-php">// School -> Student -> Grade relationship
class School extends Model
{
    public function students()
    {
        return $this->hasMany(Student::class);
    }
    
    public function grades()
    {
        return $this->hasManyThrough(
            Grade::class,
            Student::class,
            'school_id',    // Foreign key on students table
            'student_id',   // Foreign key on grades table
            'id',           // Local key on schools table
            'id'            // Local key on students table
        );
    }
    
    public function passingGrades()
    {
        return $this->grades()
                    ->where('grades.score', '>=', 60);
    }
    
    public function averageGrade()
    {
        return $this->grades()->avg('score');
    }
}

// Usage
$school = School::find(1);
echo "School average grade: " . $school->averageGrade();
echo "Passing grades: " . $school->passingGrades()->count();</code></pre>
                    </div>
                </div>

                <h3>Complex Queries</h3>
                <div class="example-section">
                    <h5>Aggregation Through Relationships</h5>
                    <pre><code class="language-php">// Countries with statistics
$countryStats = Country::select('countries.*')
    ->withCount(['posts', 'users'])
    ->withAvg('posts', 'views')
    ->having('posts_count', '>', 5)
    ->get();

foreach ($countryStats as $country) {
    echo "{$country->name}: {$country->users_count} users, ";
    echo "{$country->posts_count} posts, ";
    echo "Average views: " . round($country->posts_avg_views, 2);
}

// Top posting countries
$topPostingCountries = Country::withCount('posts')
    ->orderBy('posts_count', 'desc')
    ->take(10)
    ->get();

// Monthly post statistics by country
$monthlyStats = Country::with(['posts' => function ($query) {
    $query->whereMonth('created_at', now()->month)
          ->whereYear('created_at', now()->year);
}])->get();

// Countries with recent activity
$activeCountries = Country::whereHas('posts', function ($query) {
    $query->where('created_at', '>=', now()->subDays(30));
})->withCount(['posts' => function ($query) {
    $query->where('created_at', '>=', now()->subDays(30));
}])->get();</code></pre>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Has Many Through Relationships:</strong>
                    <ul>
                        <li><strong>Country → Users → Posts:</strong> All posts written by users in a country</li>
                        <li><strong>Category → Products → Orders:</strong> All orders for products in a category</li>
                        <li><strong>School → Students → Grades:</strong> All grades for students in a school</li>
                        <li><strong>Department → Employees → Timesheets:</strong> All timesheets for department employees</li>
                        <li><strong>Supplier → Products → Sales:</strong> All sales for supplier products</li>
                        <li><strong>Team → Players → Statistics:</strong> All statistics for team players</li>
                    </ul>
                </div>
            </section>

            <!-- Polymorphic One to One -->
            <section class="section" id="polymorphic-one-to-one">
                <h2><i class="fas fa-shapes"></i> Polymorphic One to One Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Polymorphic One-to-One</strong> relationship allows a model to belong to more than one other model on a single association. This is useful when you want to store different types of related models in the same relationship.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>users</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">email</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↘</div>
                    <div class="db-table">
                        <h5>images</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">imageable_id</span></div>
                        <div class="db-field"><span class="foreign-key">imageable_type</span></div>
                        <div class="db-field">url</div>
                        <div class="db-field">alt_text</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↗</div>
                    <div class="db-table">
                        <h5>products</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">name</div>
                        <div class="db-field">price</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Images Migration</h5>
                    <pre><code class="language-php">// Create images migration
php artisan make:migration create_images_table

public function up()
{
    Schema::create('images', function (Blueprint $table) {
        $table->id();
        $table->string('url');
        $table->string('alt_text')->nullable();
        $table->string('title')->nullable();
        $table->integer('width')->nullable();
        $table->integer('height')->nullable();
        $table->integer('file_size')->nullable(); // in bytes
        $table->morphs('imageable'); // Creates imageable_id and imageable_type
        $table->timestamps();
    });
}

// Alternative manual way
public function up()
{
    Schema::create('images', function (Blueprint $table) {
        $table->id();
        $table->string('url');
        $table->string('alt_text')->nullable();
        $table->unsignedBigInteger('imageable_id');
        $table->string('imageable_type');
        $table->timestamps();
        
        $table->index(['imageable_id', 'imageable_type']);
    });
}</code></pre>

                    <h5>Products Migration</h5>
                    <pre><code class="language-php">// Create products migration
php artisan make:migration create_products_table

public function up()
{
    Schema::create('products', function (Blueprint $table) {
        $table->id();
        $table->string('name');
        $table->text('description');
        $table->decimal('price', 10, 2);
        $table->string('sku')->unique();
        $table->integer('stock_quantity')->default(0);
        $table->boolean('is_active')->default(true);
        $table->timestamps();
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-image"></i> Image Model</h4>
                        <pre><code class="language-php">// app/Models/Image.php
class Image extends Model
{
    protected $fillable = [
        'url', 'alt_text', 'title', 
        'width', 'height', 'file_size',
        'imageable_id', 'imageable_type'
    ];

    /**
     * Get the parent imageable model.
     */
    public function imageable()
    {
        return $this->morphTo();
    }

    /**
     * Get full URL for the image.
     */
    public function getFullUrlAttribute()
    {
        return asset('storage/' . $this->url);
    }

    /**
     * Get human readable file size.
     */
    public function getFormattedSizeAttribute()
    {
        $bytes = $this->file_size;
        $units = ['B', 'KB', 'MB', 'GB'];
        
        for ($i = 0; $bytes > 1024; $i++) {
            $bytes /= 1024;
        }
        
        return round($bytes, 2) . ' ' . $units[$i];
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-user"></i> User Model</h4>
                        <pre><code class="language-php">// app/Models/User.php
class User extends Authenticatable
{
    protected $fillable = [
        'name', 'email', 'password'
    ];

    /**
     * Get the user's avatar image.
     */
    public function avatar()
    {
        return $this->morphOne(Image::class, 'imageable');
    }

    /**
     * Get avatar URL or default.
     */
    public function getAvatarUrlAttribute()
    {
        return $this->avatar 
            ? $this->avatar->full_url 
            : asset('images/default-avatar.png');
    }
}</code></pre>
                    </div>
                </div>

                <div class="feature-card">
                    <h4><i class="fas fa-box"></i> Product Model</h4>
                    <pre><code class="language-php">// app/Models/Product.php
class Product extends Model
{
    protected $fillable = [
        'name', 'description', 'price', 'sku', 
        'stock_quantity', 'is_active'
    ];

    protected $casts = [
        'price' => 'decimal:2',
        'is_active' => 'boolean'
    ];

    /**
     * Get the product's main image.
     */
    public function image()
    {
        return $this->morphOne(Image::class, 'imageable');
    }

    /**
     * Get product image URL or default.
     */
    public function getImageUrlAttribute()
    {
        return $this->image 
            ? $this->image->full_url 
            : asset('images/no-image.png');
    }

    /**
     * Get formatted price.
     */
    public function getFormattedPriceAttribute()
    {
        return '$' . number_format($this->price, 2);
    }
}</code></pre>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Records</h5>
                    <pre><code class="language-php">// Create user with avatar
$user = User::create([
    'name' => 'John Doe',
    'email' => 'john@example.com',
    'password' => bcrypt('password')
]);

$userAvatar = $user->avatar()->create([
    'url' => 'avatars/john-doe.jpg',
    'alt_text' => 'John Doe Avatar',
    'title' => 'John Doe Profile Picture',
    'width' => 150,
    'height' => 150,
    'file_size' => 25600
]);

// Create product with image
$product = Product::create([
    'name' => 'Laravel T-Shirt',
    'description' => 'Comfortable Laravel branded t-shirt',
    'price' => 29.99,
    'sku' => 'LRV-TSH-001',
    'stock_quantity' => 100
]);

$productImage = $product->image()->create([
    'url' => 'products/laravel-tshirt.jpg',
    'alt_text' => 'Laravel T-Shirt',
    'title' => 'Laravel T-Shirt Product Image',
    'width' => 800,
    'height' => 600,
    'file_size' => 145920
]);

// Create image directly
$image = Image::create([
    'url' => 'uploads/sample.jpg',
    'alt_text' => 'Sample Image',
    'imageable_id' => $user->id,
    'imageable_type' => User::class
]);</code></pre>

                    <h5>Retrieving Related Data</h5>
                    <pre><code class="language-php">// Get user with avatar
$user = User::with('avatar')->find(1);

if ($user->avatar) {
    echo '<img src="' . $user->avatar->full_url . '" alt="' . $user->avatar->alt_text . '">';
}

// Get product with image
$product = Product::with('image')->find(1);

echo '<h3>' . $product->name . '</h3>';
echo '<img src="' . $product->image_url . '" alt="' . $product->name . '">';
echo '<p>Price: ' . $product->formatted_price . '</p>';

// Get image with its parent model
$image = Image::with('imageable')->find(1);

switch (class_basename($image->imageable_type)) {
    case 'User':
        echo "This is a user avatar for: " . $image->imageable->name;
        break;
    case 'Product':
        echo "This is a product image for: " . $image->imageable->name;
        break;
}</code></pre>

                    <h5>Querying Relationships</h5>
                    <pre><code class="language-php">// Users with avatars
$usersWithAvatars = User::has('avatar')->get();

// Products without images
$productsWithoutImages = Product::doesntHave('image')->get();

// Images for specific model type
$userAvatars = Image::where('imageable_type', User::class)->get();
$productImages = Image::where('imageable_type', Product::class)->get();

// Complex queries
$recentUserAvatars = Image::where('imageable_type', User::class)
    ->where('created_at', '>=', now()->subDays(7))
    ->with('imageable')
    ->get();

// Large images
$largeImages = Image::where('file_size', '>', 100000) // > 100KB
    ->with('imageable')
    ->get();

foreach ($largeImages as $image) {
    $model = class_basename($image->imageable_type);
    echo "{$model} image: {$image->formatted_size}";
}</code></pre>
                </div>

                <h3>Advanced Usage</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-cog"></i> Custom Polymorphic Types</h4>
                        <pre><code class="language-php">// Map polymorphic types to avoid storing full class names
use Illuminate\Database\Eloquent\Relations\Relation;

// In AppServiceProvider boot method
Relation::enforceMorphMap([
    'user' => User::class,
    'product' => Product::class,
    'post' => Post::class,
]);

// Now database stores 'user' instead of 'App\Models\User'</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-search"></i> Type-Specific Queries</h4>
                        <pre><code class="language-php">// Scope for specific imageable types
class Image extends Model
{
    public function scopeForUsers($query)
    {
        return $query->where('imageable_type', User::class);
    }
    
    public function scopeForProducts($query)
    {
        return $query->where('imageable_type', Product::class);
    }
    
    public function scopeLarge($query)
    {
        return $query->where('file_size', '>', 500000);
    }
}

// Usage
$userAvatars = Image::forUsers()->get();
$largeProductImages = Image::forProducts()->large()->get();</code></pre>
                    </div>
                </div>

                <h3>Multiple Polymorphic Relationships</h3>
                <div class="example-section">
                    <h5>Adding More Models</h5>
                    <pre><code class="language-php">// Post model with featured image
class Post extends Model
{
    protected $fillable = [
        'title', 'content', 'slug', 'published_at'
    ];

    public function featuredImage()
    {
        return $this->morphOne(Image::class, 'imageable');
    }
}

// Category model with icon
class Category extends Model
{
    protected $fillable = ['name', 'slug', 'description'];

    public function icon()
    {
        return $this->morphOne(Image::class, 'imageable');
    }
}

// Usage
$post = Post::create([
    'title' => 'Laravel Eloquent Guide',
    'content' => 'Complete guide to Laravel Eloquent...',
    'slug' => 'laravel-eloquent-guide'
]);

$post->featuredImage()->create([
    'url' => 'posts/eloquent-guide.jpg',
    'alt_text' => 'Laravel Eloquent Guide',
    'title' => 'Featured image for Laravel Eloquent Guide'
]);</code></pre>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Polymorphic One-to-One Relationships:</strong>
                    <ul>
                        <li><strong>Images:</strong> Users (avatars), Products (main image), Posts (featured image)</li>
                        <li><strong>Addresses:</strong> Users (home address), Companies (office address), Suppliers (warehouse)</li>
                        <li><strong>Metadata:</strong> Posts, Pages, Products (SEO metadata)</li>
                        <li><strong>Settings:</strong> Users, Organizations, Applications (configuration settings)</li>
                        <li><strong>Documents:</strong> Orders (invoice), Users (resume), Products (manual)</li>
                    </ul>
                </div>
            </section>

            <!-- Polymorphic One to Many -->
            <section class="section" id="polymorphic-one-to-many">
                <h2><i class="fas fa-sitemap"></i> Polymorphic One to Many Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Polymorphic One-to-Many</strong> relationship allows a model to belong to more than one other model on a single association, where each parent can have multiple children. This is commonly used for features like comments, ratings, or tags that can belong to different types of content.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>posts</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">title</div>
                        <div class="db-field">content</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↘</div>
                    <div class="db-table">
                        <h5>comments</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field"><span class="foreign-key">commentable_id</span></div>
                        <div class="db-field"><span class="foreign-key">commentable_type</span></div>
                        <div class="db-field">content</div>
                        <div class="db-field">user_id</div>
                    </div>
                    <div style="display: inline-block; margin: 1rem; font-size: 1.5rem;">↗</div>
                    <div class="db-table">
                        <h5>videos</h5>
                        <div class="db-field"><span class="primary-key">id</span> - Primary Key</div>
                        <div class="db-field">title</div>
                        <div class="db-field">url</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Comments Migration</h5>
                    <pre><code class="language-php">// Create comments migration
php artisan make:migration create_comments_table

public function up()
{
    Schema::create('comments', function (Blueprint $table) {
        $table->id();
        $table->text('content');
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->morphs('commentable'); // Creates commentable_id and commentable_type
        $table->foreignId('parent_id')->nullable()->constrained('comments')->onDelete('cascade');
        $table->boolean('is_approved')->default(false);
        $table->integer('likes_count')->default(0);
        $table->timestamps();
        
        $table->index(['commentable_id', 'commentable_type']);
    });
}</code></pre>

                    <h5>Videos Migration</h5>
                    <pre><code class="language-php">// Create videos migration
php artisan make:migration create_videos_table

public function up()
{
    Schema::create('videos', function (Blueprint $table) {
        $table->id();
        $table->string('title');
        $table->text('description');
        $table->string('url');
        $table->string('thumbnail')->nullable();
        $table->integer('duration')->nullable(); // in seconds
        $table->integer('views_count')->default(0);
        $table->boolean('is_published')->default(false);
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->timestamps();
    });
}</code></pre>

                    <h5>Ratings Migration</h5>
                    <pre><code class="language-php">// Create ratings migration for another example
php artisan make:migration create_ratings_table

public function up()
{
    Schema::create('ratings', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->morphs('ratable');
        $table->integer('rating')->unsigned(); // 1-5 stars
        $table->text('review')->nullable();
        $table->boolean('is_verified')->default(false);
        $table->timestamps();
        
        // Prevent duplicate ratings from same user
        $table->unique(['user_id', 'ratable_id', 'ratable_type']);
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-comment"></i> Comment Model</h4>
                        <pre><code class="language-php">// app/Models/Comment.php
class Comment extends Model
{
    protected $fillable = [
        'content', 'user_id', 'commentable_id', 
        'commentable_type', 'parent_id', 'is_approved'
    ];

    protected $casts = [
        'is_approved' => 'boolean'
    ];

    /**
     * Get the parent commentable model.
     */
    public function commentable()
    {
        return $this->morphTo();
    }

    /**
     * Get the user who wrote the comment.
     */
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    /**
     * Get the parent comment.
     */
    public function parent()
    {
        return $this->belongsTo(Comment::class, 'parent_id');
    }

    /**
     * Get the replies to this comment.
     */
    public function replies()
    {
        return $this->hasMany(Comment::class, 'parent_id');
    }

    /**
     * Scope for approved comments only.
     */
    public function scopeApproved($query)
    {
        return $query->where('is_approved', true);
    }

    /**
     * Scope for top-level comments (no parent).
     */
    public function scopeParent($query)
    {
        return $query->whereNull('parent_id');
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-file-alt"></i> Post Model</h4>
                        <pre><code class="language-php">// app/Models/Post.php
class Post extends Model
{
    protected $fillable = [
        'title', 'content', 'slug', 'user_id', 'published_at'
    ];

    protected $dates = ['published_at'];

    /**
     * Get all comments for the post.
     */
    public function comments()
    {
        return $this->morphMany(Comment::class, 'commentable');
    }

    /**
     * Get approved comments only.
     */
    public function approvedComments()
    {
        return $this->morphMany(Comment::class, 'commentable')
                    ->approved()
                    ->with(['user', 'replies.user']);
    }

    /**
     * Get top-level comments with replies.
     */
    public function parentComments()
    {
        return $this->morphMany(Comment::class, 'commentable')
                    ->parent()
                    ->approved()
                    ->with(['user', 'replies.user'])
                    ->latest();
    }

    /**
     * Get all ratings for the post.
     */
    public function ratings()
    {
        return $this->morphMany(Rating::class, 'ratable');
    }

    /**
     * Get average rating.
     */
    public function getAverageRatingAttribute()
    {
        return $this->ratings()->avg('rating');
    }
}</code></pre>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-video"></i> Video Model</h4>
                        <pre><code class="language-php">// app/Models/Video.php
class Video extends Model
{
    protected $fillable = [
        'title', 'description', 'url', 'thumbnail',
        'duration', 'is_published', 'user_id'
    ];

    protected $casts = [
        'is_published' => 'boolean'
    ];

    /**
     * Get all comments for the video.
     */
    public function comments()
    {
        return $this->morphMany(Comment::class, 'commentable');
    }

    /**
     * Get approved comments with user and replies.
     */
    public function approvedComments()
    {
        return $this->morphMany(Comment::class, 'commentable')
                    ->approved()
                    ->parent()
                    ->with(['user', 'replies.user'])
                    ->latest();
    }

    /**
     * Get all ratings for the video.
     */
    public function ratings()
    {
        return $this->morphMany(Rating::class, 'ratable');
    }

    /**
     * Get user who created the video.
     */
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    /**
     * Get formatted duration.
     */
    public function getFormattedDurationAttribute()
    {
        $minutes = floor($this->duration / 60);
        $seconds = $this->duration % 60;
        return sprintf('%d:%02d', $minutes, $seconds);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-star"></i> Rating Model</h4>
                        <pre><code class="language-php">// app/Models/Rating.php
class Rating extends Model
{
    protected $fillable = [
        'user_id', 'ratable_id', 'ratable_type',
        'rating', 'review', 'is_verified'
    ];

    protected $casts = [
        'is_verified' => 'boolean'
    ];

    /**
     * Get the parent ratable model.
     */
    public function ratable()
    {
        return $this->morphTo();
    }

    /**
     * Get the user who gave the rating.
     */
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    /**
     * Scope for verified ratings only.
     */
    public function scopeVerified($query)
    {
        return $query->where('is_verified', true);
    }

    /**
     * Scope for specific rating value.
     */
    public function scopeWithRating($query, $rating)
    {
        return $query->where('rating', $rating);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating Comments</h5>
                    <pre><code class="language-php">// Create comment on a post
$post = Post::find(1);
$user = User::find(1);

$comment = $post->comments()->create([
    'content' => 'Great post! Very informative.',
    'user_id' => $user->id,
    'is_approved' => true
]);

// Create comment on a video
$video = Video::find(1);

$videoComment = $video->comments()->create([
    'content' => 'Amazing video quality!',
    'user_id' => $user->id,
    'is_approved' => true
]);

// Create reply to a comment
$reply = $comment->replies()->create([
    'content' => 'I agree with this comment!',
    'user_id' => 2,
    'commentable_id' => $post->id,
    'commentable_type' => Post::class,
    'is_approved' => true
]);

// Create multiple comments
$post->comments()->createMany([
    [
        'content' => 'First comment',
        'user_id' => 1,
        'is_approved' => true
    ],
    [
        'content' => 'Second comment',
        'user_id' => 2,
        'is_approved' => true
    ]
]);</code></pre>

                    <h5>Retrieving Comments</h5>
                    <pre><code class="language-php">// Get all comments for a post
$post = Post::with('comments.user')->find(1);

foreach ($post->comments as $comment) {
    echo $comment->user->name . ': ' . $comment->content;
}

// Get approved comments with replies
$post = Post::with('parentComments')->find(1);

foreach ($post->parentComments as $comment) {
    echo $comment->user->name . ': ' . $comment->content;
    
    foreach ($comment->replies as $reply) {
        echo '└─ ' . $reply->user->name . ': ' . $reply->content;
    }
}

// Get comments for multiple content types
$comments = Comment::with(['commentable', 'user'])
    ->approved()
    ->latest()
    ->take(10)
    ->get();

foreach ($comments as $comment) {
    $type = class_basename($comment->commentable_type);
    $title = $comment->commentable->title;
    echo "{$comment->user->name} commented on {$type}: {$title}";
}</code></pre>

                    <h5>Querying Relationships</h5>
                    <pre><code class="language-php">// Posts with comments
$postsWithComments = Post::has('comments')->get();

// Posts with many comments
$popularPosts = Post::has('comments', '>=', 10)->get();

// Videos with approved comments
$videosWithComments = Video::whereHas('comments', function ($query) {
    $query->approved();
})->get();

// Get content by comment count
$contentWithCommentCount = collect([
    Post::withCount('comments')->get(),
    Video::withCount('comments')->get()
])->flatten()->sortByDesc('comments_count');

// Recent comments across all content types
$recentComments = Comment::with(['commentable', 'user'])
    ->where('created_at', '>=', now()->subDays(7))
    ->approved()
    ->latest()
    ->get();

// Top commenters
$topCommenters = User::withCount('comments')
    ->having('comments_count', '>', 5)
    ->orderBy('comments_count', 'desc')
    ->get();</code></pre>
                </div>

                <h3>Advanced Examples</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-star-half-alt"></i> Rating System</h4>
                        <pre><code class="language-php">// Create rating for a post
$post = Post::find(1);

$rating = $post->ratings()->create([
    'user_id' => auth()->id(),
    'rating' => 5,
    'review' => 'Excellent content!',
    'is_verified' => true
]);

// Get average ratings
$averageRating = $post->ratings()->avg('rating');
$ratingCount = $post->ratings()->count();

echo "Average: " . round($averageRating, 1) . "/5 ({$ratingCount} reviews)";

// Get rating distribution
$distribution = $post->ratings()
    ->selectRaw('rating, count(*) as count')
    ->groupBy('rating')
    ->orderBy('rating', 'desc')
    ->get();

foreach ($distribution as $item) {
    echo "{$item->rating} stars: {$item->count} reviews";
}

// User's rating for content
$userRating = $post->ratings()
    ->where('user_id', auth()->id())
    ->first();

if ($userRating) {
    echo "You rated this: {$userRating->rating}/5";
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-chart-line"></i> Comment Analytics</h4>
                        <pre><code class="language-php">// Comment statistics
class CommentAnalytics
{
    public static function getStats()
    {
        return [
            'total_comments' => Comment::count(),
            'approved_comments' => Comment::approved()->count(),
            'pending_comments' => Comment::where('is_approved', false)->count(),
            'comments_today' => Comment::whereDate('created_at', today())->count(),
            'top_commenters' => User::withCount('comments')
                ->orderBy('comments_count', 'desc')
                ->take(5)
                ->get(),
            'content_with_most_comments' => self::getTopCommentedContent()
        ];
    }
    
    private static function getTopCommentedContent()
    {
        $posts = Post::withCount('comments')
            ->orderBy('comments_count', 'desc')
            ->take(3)
            ->get()
            ->map(fn($post) => [
                'type' => 'Post',
                'title' => $post->title,
                'comments' => $post->comments_count
            ]);
            
        $videos = Video::withCount('comments')
            ->orderBy('comments_count', 'desc')
            ->take(3)
            ->get()
            ->map(fn($video) => [
                'type' => 'Video',
                'title' => $video->title,
                'comments' => $video->comments_count
            ]);
            
        return $posts->merge($videos)
            ->sortByDesc('comments')
            ->take(5);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Comment Moderation</h3>
                <div class="example-section">
                    <h5>Approval System</h5>
                    <pre><code class="language-php">// Comment moderation methods
class Comment extends Model
{
    public function approve()
    {
        $this->update(['is_approved' => true]);
        
        // Notify comment author
        $this->user->notify(new CommentApproved($this));
        
        return $this;
    }
    
    public function reject()
    {
        $this->update(['is_approved' => false]);
        
        // Notify comment author
        $this->user->notify(new CommentRejected($this));
        
        return $this;
    }
    
    public function isSpam()
    {
        // Simple spam detection logic
        return str_contains(strtolower($this->content), 'spam') ||
               str_contains(strtolower($this->content), 'buy now') ||
               strlen($this->content) < 10;
    }
}

// Usage in controller
class CommentController extends Controller
{
    public function store(Request $request, $type, $id)
    {
        $model = $this->getModel($type, $id);
        
        $comment = $model->comments()->create([
            'content' => $request->content,
            'user_id' => auth()->id(),
            'is_approved' => !Comment::make($request->all())->isSpam()
        ]);
        
        if (!$comment->is_approved) {
            // Queue for moderation
            dispatch(new ReviewComment($comment));
        }
        
        return response()->json($comment);
    }
    
    private function getModel($type, $id)
    {
        return match($type) {
            'post' => Post::findOrFail($id),
            'video' => Video::findOrFail($id),
            default => abort(404)
        };
    }
}</code></pre>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Polymorphic One-to-Many Relationships:</strong>
                    <ul>
                        <li><strong>Comments:</strong> Posts, Videos, Products, Events can all have comments</li>
                        <li><strong>Ratings/Reviews:</strong> Products, Services, Movies, Books can be rated</li>
                        <li><strong>Tags:</strong> Posts, Videos, Images, Documents can be tagged</li>
                        <li><strong>Likes:</strong> Posts, Comments, Photos can be liked</li>
                        <li><strong>Attachments:</strong> Emails, Support tickets, Reports can have files</li>
                        <li><strong>Activity Logs:</strong> Users, Orders, Projects can have activity records</li>
                    </ul>
                </div>
            </section>

            <!-- Polymorphic Many to Many -->
            <section class="section" id="polymorphic-many-to-many">
                <h2><i class="fas fa-network-wired"></i> Polymorphic Many to Many Relationship</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Definition</h4>
                    <p>A <strong>Polymorphic Many-to-Many</strong> relationship allows a single model to be associated with multiple other models through a pivot table. This is useful for features like tagging system where tags can be applied to different types of content.</p>
                </div>

                <h3>Database Example</h3>
                <div class="db-diagram">
                    <div class="db-table">
                        <h5>posts</h5>
                        <div class="db-field"><span class="primary-key">id</span></div>
                        <div class="db-field">title</div>
                        <div class="db-field">content</div>
                    </div>
                    <div style="display: inline-block; margin: 0.5rem; font-size: 1.2rem;">↘</div>
                    <div class="db-table">
                        <h5>taggables</h5>
                        <div class="db-field"><span class="foreign-key">tag_id</span></div>
                        <div class="db-field"><span class="foreign-key">taggable_id</span></div>
                        <div class="db-field"><span class="foreign-key">taggable_type</span></div>
                    </div>
                    <div style="display: inline-block; margin: 0.5rem; font-size: 1.2rem;">↗</div>
                    <div class="db-table">
                        <h5>videos</h5>
                        <div class="db-field"><span class="primary-key">id</span></div>
                        <div class="db-field">title</div>
                        <div class="db-field">url</div>
                    </div>
                    <div style="display: block; text-align: center; margin: 1rem;">↕</div>
                    <div class="db-table" style="margin: 0 auto;">
                        <h5>tags</h5>
                        <div class="db-field"><span class="primary-key">id</span></div>
                        <div class="db-field">name</div>
                        <div class="db-field">slug</div>
                    </div>
                </div>

                <h3>Migration Setup</h3>
                <div class="example-section">
                    <h5>Tags Migration</h5>
                    <pre><code class="language-php">// Create tags migration
php artisan make:migration create_tags_table

public function up()
{
    Schema::create('tags', function (Blueprint $table) {
        $table->id();
        $table->string('name')->unique();
        $table->string('slug')->unique();
        $table->string('color', 7)->default('#6366f1'); // hex color
        $table->text('description')->nullable();
        $table->integer('usage_count')->default(0);
        $table->boolean('is_featured')->default(false);
        $table->timestamps();
    });
}</code></pre>

                    <h5>Taggables Pivot Migration</h5>
                    <pre><code class="language-php">// Create taggables pivot migration
php artisan make:migration create_taggables_table

public function up()
{
    Schema::create('taggables', function (Blueprint $table) {
        $table->id();
        $table->foreignId('tag_id')->constrained()->onDelete('cascade');
        $table->morphs('taggable'); // Creates taggable_id and taggable_type
        $table->timestamps();
        
        // Prevent duplicate tag assignments
        $table->unique(['tag_id', 'taggable_id', 'taggable_type']);
        
        // Index for better query performance
        $table->index(['taggable_id', 'taggable_type']);
    });
}</code></pre>

                    <h5>Alternative: Custom Pivot Table Names</h5>
                    <pre><code class="language-php">// If you want specific pivot table names
php artisan make:migration create_post_tag_table
php artisan make:migration create_video_tag_table

// Or use a single polymorphic pivot table (recommended)
php artisan make:migration create_tag_assignments_table

public function up()
{
    Schema::create('tag_assignments', function (Blueprint $table) {
        $table->id();
        $table->foreignId('tag_id')->constrained()->onDelete('cascade');
        $table->morphs('assignable');
        $table->foreignId('assigned_by')->nullable()->constrained('users');
        $table->timestamp('assigned_at')->useCurrent();
        $table->timestamps();
        
        $table->unique(['tag_id', 'assignable_id', 'assignable_type'], 'unique_tag_assignment');
    });
}</code></pre>
                </div>

                <h3>Model Definitions</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-tag"></i> Tag Model</h4>
                        <pre><code class="language-php">// app/Models/Tag.php
class Tag extends Model
{
    protected $fillable = [
        'name', 'slug', 'color', 'description', 
        'usage_count', 'is_featured'
    ];

    protected $casts = [
        'is_featured' => 'boolean'
    ];

    /**
     * Get all posts that have this tag.
     */
    public function posts()
    {
        return $this->morphedByMany(Post::class, 'taggable');
    }

    /**
     * Get all videos that have this tag.
     */
    public function videos()
    {
        return $this->morphedByMany(Video::class, 'taggable');
    }

    /**
     * Get all products that have this tag.
     */
    public function products()
    {
        return $this->morphedByMany(Product::class, 'taggable');
    }

    /**
     * Get all taggable models for this tag.
     */
    public function taggables()
    {
        return $this->hasMany(Taggable::class);
    }

    /**
     * Increment usage count when tag is used.
     */
    public function incrementUsage()
    {
        $this->increment('usage_count');
        return $this;
    }

    /**
     * Decrement usage count when tag is removed.
     */
    public function decrementUsage()
    {
        $this->decrement('usage_count');
        return $this;
    }

    /**
     * Get route key name for URL generation.
     */
    public function getRouteKeyName()
    {
        return 'slug';
    }

    /**
     * Scope for popular tags.
     */
    public function scopePopular($query, $limit = 10)
    {
        return $query->orderBy('usage_count', 'desc')->take($limit);
    }

    /**
     * Scope for featured tags.
     */
    public function scopeFeatured($query)
    {
        return $query->where('is_featured', true);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-file-alt"></i> Post Model</h4>
                        <pre><code class="language-php">// app/Models/Post.php
class Post extends Model
{
    protected $fillable = [
        'title', 'content', 'slug', 'user_id', 'published_at'
    ];

    protected $dates = ['published_at'];

    /**
     * Get all tags for the post.
     */
    public function tags()
    {
        return $this->morphToMany(Tag::class, 'taggable')
                    ->withTimestamps();
    }

    /**
     * Assign tags to the post.
     */
    public function assignTags($tags)
    {
        // Convert to collection if needed
        $tags = collect($tags)->map(function ($tag) {
            return is_string($tag) ? Tag::firstOrCreate([
                'name' => $tag,
                'slug' => Str::slug($tag)
            ]) : $tag;
        });

        // Sync tags and update usage counts
        $this->tags()->sync($tags->pluck('id'));
        
        // Update usage counts
        $tags->each->incrementUsage();
        
        return $this;
    }

    /**
     * Add single tag to the post.
     */
    public function addTag($tag)
    {
        if (is_string($tag)) {
            $tag = Tag::firstOrCreate([
                'name' => $tag,
                'slug' => Str::slug($tag)
            ]);
        }

        if (!$this->tags->contains($tag->id)) {
            $this->tags()->attach($tag);
            $tag->incrementUsage();
        }

        return $this;
    }

    /**
     * Remove tag from the post.
     */
    public function removeTag($tag)
    {
        if (is_string($tag)) {
            $tag = Tag::where('name', $tag)->first();
        }

        if ($tag && $this->tags->contains($tag->id)) {
            $this->tags()->detach($tag);
            $tag->decrementUsage();
        }

        return $this;
    }

    /**
     * Check if post has a specific tag.
     */
    public function hasTag($tag)
    {
        if (is_string($tag)) {
            return $this->tags->contains('name', $tag);
        }

        return $this->tags->contains($tag);
    }
}</code></pre>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-video"></i> Video Model</h4>
                        <pre><code class="language-php">// app/Models/Video.php
class Video extends Model
{
    protected $fillable = [
        'title', 'description', 'url', 'thumbnail',
        'duration', 'is_published', 'user_id'
    ];

    protected $casts = [
        'is_published' => 'boolean'
    ];

    /**
     * Get all tags for the video.
     */
    public function tags()
    {
        return $this->morphToMany(Tag::class, 'taggable')
                    ->withTimestamps();
    }

    /**
     * Assign tags to the video.
     */
    public function assignTags($tags)
    {
        $tags = collect($tags)->map(function ($tag) {
            return is_string($tag) ? Tag::firstOrCreate([
                'name' => $tag,
                'slug' => Str::slug($tag)
            ]) : $tag;
        });

        $this->tags()->sync($tags->pluck('id'));
        $tags->each->incrementUsage();
        
        return $this;
    }

    /**
     * Get formatted duration.
     */
    public function getFormattedDurationAttribute()
    {
        $minutes = floor($this->duration / 60);
        $seconds = $this->duration % 60;
        return sprintf('%d:%02d', $minutes, $seconds);
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-box"></i> Product Model</h4>
                        <pre><code class="language-php">// app/Models/Product.php
class Product extends Model
{
    protected $fillable = [
        'name', 'description', 'price', 'sku',
        'stock_quantity', 'is_active'
    ];

    protected $casts = [
        'price' => 'decimal:2',
        'is_active' => 'boolean'
    ];

    /**
     * Get all tags for the product.
     */
    public function tags()
    {
        return $this->morphToMany(Tag::class, 'taggable')
                    ->withTimestamps();
    }

    /**
     * Assign tags to the product.
     */
    public function assignTags($tags)
    {
        $tags = collect($tags)->map(function ($tag) {
            return is_string($tag) ? Tag::firstOrCreate([
                'name' => $tag,
                'slug' => Str::slug($tag)
            ]) : $tag;
        });

        $this->tags()->sync($tags->pluck('id'));
        $tags->each->incrementUsage();
        
        return $this;
    }

    /**
     * Filter products by tags.
     */
    public function scopeWithTags($query, $tags)
    {
        return $query->whereHas('tags', function ($q) use ($tags) {
            $q->whereIn('slug', (array) $tags);
        });
    }
}</code></pre>
                    </div>
                </div>

                <h3>Usage Examples</h3>
                <div class="example-section">
                    <h5>Creating and Assigning Tags</h5>
                    <pre><code class="language-php">// Create tags
$laravelTag = Tag::create([
    'name' => 'Laravel',
    'slug' => 'laravel',
    'color' => '#f56565',
    'description' => 'Posts about Laravel framework'
]);

$phpTag = Tag::create([
    'name' => 'PHP',
    'slug' => 'php',
    'color' => '#4c51bf',
    'description' => 'Posts about PHP programming'
]);

// Assign tags to a post
$post = Post::find(1);

// Method 1: Using sync
$post->tags()->sync([1, 2, 3]);

// Method 2: Using custom method
$post->assignTags(['Laravel', 'PHP', 'Tutorial']);

// Method 3: Attach individual tags
$post->tags()->attach($laravelTag);
$post->addTag('Web Development');

// Assign tags to different content types
$video = Video::find(1);
$video->assignTags(['Laravel', 'Tutorial', 'Beginner']);

$product = Product::find(1);
$product->assignTags(['Electronics', 'Smartphone', 'Apple']);</code></pre>

                    <h5>Retrieving Tagged Content</h5>
                    <pre><code class="language-php">// Get all content with a specific tag
$tag = Tag::where('slug', 'laravel')->first();

$taggedPosts = $tag->posts()->published()->get();
$taggedVideos = $tag->videos()->where('is_published', true)->get();
$taggedProducts = $tag->products()->where('is_active', true)->get();

// Get tag with all its content
$tag = Tag::with(['posts', 'videos', 'products'])->find(1);

// Get posts with their tags
$posts = Post::with('tags')->get();

foreach ($posts as $post) {
    echo $post->title . ': ';
    echo $post->tags->pluck('name')->implode(', ');
}

// Get content by multiple tags
$posts = Post::whereHas('tags', function ($query) {
    $query->whereIn('slug', ['laravel', 'php']);
})->get();

// Get content with all specified tags
$posts = Post::whereHas('tags', function ($query) {
    $query->whereIn('slug', ['laravel', 'tutorial']);
}, '=', 2)->get(); // Must have both tags</code></pre>

                    <h5>Tag Management</h5>
                    <pre><code class="language-php">// Get popular tags
$popularTags = Tag::popular(10)->get();

// Get featured tags
$featuredTags = Tag::featured()->get();

// Tag cloud with usage counts
$tagCloud = Tag::select('name', 'slug', 'usage_count', 'color')
    ->where('usage_count', '>', 0)
    ->orderBy('usage_count', 'desc')
    ->take(50)
    ->get();

// Find unused tags
$unusedTags = Tag::where('usage_count', 0)->get();

// Clean up unused tags
Tag::where('usage_count', 0)
   ->where('created_at', '<', now()->subMonths(3))
   ->delete();

// Get tag statistics
$tagStats = [
    'total_tags' => Tag::count(),
    'used_tags' => Tag::where('usage_count', '>', 0)->count(),
    'most_popular' => Tag::orderBy('usage_count', 'desc')->first(),
    'recently_created' => Tag::latest()->take(5)->get()
];</code></pre>
                </div>

                <h3>Advanced Usage</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-search"></i> Tag-based Search</h4>
                        <pre><code class="language-php">// Search across different content types by tags
class TagSearchService
{
    public function search($tags, $contentTypes = ['posts', 'videos', 'products'])
    {
        $results = [];
        
        if (in_array('posts', $contentTypes)) {
            $results['posts'] = Post::whereHas('tags', function ($query) use ($tags) {
                $query->whereIn('slug', $tags);
            })->with('tags')->get();
        }
        
        if (in_array('videos', $contentTypes)) {
            $results['videos'] = Video::whereHas('tags', function ($query) use ($tags) {
                $query->whereIn('slug', $tags);
            })->with('tags')->get();
        }
        
        if (in_array('products', $contentTypes)) {
            $results['products'] = Product::whereHas('tags', function ($query) use ($tags) {
                $query->whereIn('slug', $tags);
            })->with('tags')->get();
        }
        
        return $results;
    }
    
    public function getRelatedTags($tags, $limit = 10)
    {
        // Find tags that commonly appear with the given tags
        return Tag::whereHas('posts', function ($query) use ($tags) {
            $query->whereHas('tags', function ($q) use ($tags) {
                $q->whereIn('slug', $tags);
            });
        })->orWhereHas('videos', function ($query) use ($tags) {
            $query->whereHas('tags', function ($q) use ($tags) {
                $q->whereIn('slug', $tags);
            });
        })->whereNotIn('slug', $tags)
          ->orderBy('usage_count', 'desc')
          ->take($limit)
          ->get();
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-chart-bar"></i> Tag Analytics</h4>
                        <pre><code class="language-php">// Tag analytics and insights
class TagAnalytics
{
    public function getTagPerformance()
    {
        return Tag::select('tags.*')
            ->withCount(['posts', 'videos', 'products'])
            ->orderBy('usage_count', 'desc')
            ->get()
            ->map(function ($tag) {
                return [
                    'name' => $tag->name,
                    'total_usage' => $tag->usage_count,
                    'posts_count' => $tag->posts_count,
                    'videos_count' => $tag->videos_count,
                    'products_count' => $tag->products_count,
                    'engagement_score' => $this->calculateEngagement($tag)
                ];
            });
    }
    
    public function getTrendingTags($days = 7)
    {
        $since = now()->subDays($days);
        
        return Tag::whereHas('posts', function ($query) use ($since) {
            $query->where('created_at', '>=', $since);
        })->orWhereHas('videos', function ($query) use ($since) {
            $query->where('created_at', '>=', $since);
        })->withCount(['posts' => function ($query) use ($since) {
            $query->where('created_at', '>=', $since);
        }])->orderBy('posts_count', 'desc')
          ->take(10)
          ->get();
    }
    
    private function calculateEngagement($tag)
    {
        // Simple engagement calculation based on recent usage
        $recentUsage = $tag->posts()->where('created_at', '>=', now()->subDays(30))->count();
        return ($recentUsage / max($tag->usage_count, 1)) * 100;
    }
}</code></pre>
                    </div>
                </div>

                <h3>Custom Pivot Model</h3>
                <div class="example-section">
                    <h5>Enhanced Taggable Pivot</h5>
                    <pre><code class="language-php">// Create custom pivot model
// app/Models/Taggable.php
class Taggable extends Pivot
{
    protected $table = 'taggables';
    
    protected $fillable = [
        'tag_id', 'taggable_id', 'taggable_type', 'assigned_by'
    ];

    public $timestamps = true;

    /**
     * Get the tag.
     */
    public function tag()
    {
        return $this->belongsTo(Tag::class);
    }

    /**
     * Get the user who assigned the tag.
     */
    public function assignedBy()
    {
        return $this->belongsTo(User::class, 'assigned_by');
    }

    /**
     * Get the taggable model.
     */
    public function taggable()
    {
        return $this->morphTo();
    }
}

// Update Tag model to use custom pivot
public function posts()
{
    return $this->morphedByMany(Post::class, 'taggable')
                ->using(Taggable::class)
                ->withPivot('assigned_by')
                ->withTimestamps();
}

// Usage with custom pivot data
$post->tags()->attach($tag->id, [
    'assigned_by' => auth()->id()
]);

// Access pivot data
$post = Post::with('tags')->find(1);
foreach ($post->tags as $tag) {
    echo "Tag: {$tag->name}, Assigned by: {$tag->pivot->assignedBy->name}";
}</code></pre>
                </div>

                <h3>Real-World Examples</h3>
                <div class="alert success">
                    <strong>Common Polymorphic Many-to-Many Relationships:</strong>
                    <ul>
                        <li><strong>Tagging System:</strong> Tags can be applied to Posts, Videos, Products, etc.</li>
                        <li><strong>Categories:</strong> Multiple content types can belong to multiple categories</li>
                        <li><strong>Permissions:</strong> Users and Roles can have multiple permissions</li>
                        <li><strong>Skills:</strong> Users and Job listings can have multiple skills</li>
                        <li><strong>Features:</strong> Products and Services can have multiple features</li>
                        <li><strong>Locations:</strong> Events, Businesses, Users can be associated with multiple locations</li>
                    </ul>
                </div>
            </section>

            <!-- Eager Loading -->
            <section class="section" id="eager-loading">
                <h2><i class="fas fa-rocket"></i> Eager Loading</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> What is Eager Loading?</h4>
                    <p><strong>Eager Loading</strong> is the process of loading related models along with the main model in a single query or a minimal number of queries. This prevents the N+1 query problem and significantly improves performance.</p>
                </div>

                <h3>The N+1 Query Problem</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-times-circle"></i> Without Eager Loading (N+1 Problem)</h4>
                        <pre><code class="language-php">// This will execute N+1 queries!
$posts = Post::all(); // 1 query

foreach ($posts as $post) {
    echo $post->user->name; // N additional queries (one per post)
}

// If you have 100 posts, this executes 101 queries!</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-check-circle"></i> With Eager Loading (Optimized)</h4>
                        <pre><code class="language-php">// This executes only 2 queries!
$posts = Post::with('user')->get(); // 1 query for posts + 1 query for users

foreach ($posts as $post) {
    echo $post->user->name; // No additional queries!
}

// Always executes only 2 queries regardless of post count</code></pre>
                    </div>
                </div>

                <h3>Basic Eager Loading</h3>
                <div class="example-section">
                    <h5>Single Relationship</h5>
                    <pre><code class="language-php">// Load posts with users
$posts = Post::with('user')->get();

// Load users with profiles
$users = User::with('profile')->get();

// Load products with categories
$products = Product::with('categories')->get();</code></pre>

                    <h5>Multiple Relationships</h5>
                    <pre><code class="language-php">// Load posts with user and comments
$posts = Post::with('user', 'comments')->get();

// Alternative array syntax
$posts = Post::with(['user', 'comments'])->get();

// Load user with profile, posts, and comments
$user = User::with('profile', 'posts', 'comments')->find(1);</code></pre>

                    <h5>Nested Relationships</h5>
                    <pre><code class="language-php">// Load posts with user and user's profile
$posts = Post::with('user.profile')->get();

// Load posts with comments and comment authors
$posts = Post::with('comments.user')->get();

// Load posts with user, user's profile, comments and comment authors
$posts = Post::with(['user.profile', 'comments.user'])->get();

// Deep nesting
$posts = Post::with('user.profile.avatar', 'comments.user.profile')->get();</code></pre>
                </div>

                <h3>Conditional Eager Loading</h3>
                <div class="example-section">
                    <h5>Loading with Constraints</h5>
                    <pre><code class="language-php">// Load posts with only published comments
$posts = Post::with(['comments' => function ($query) {
    $query->where('approved', true)->orderBy('created_at', 'desc');
}])->get();

// Load users with recent posts
$users = User::with(['posts' => function ($query) {
    $query->where('created_at', '>=', now()->subDays(30))
          ->orderBy('created_at', 'desc');
}])->get();

// Load posts with top 5 comments
$posts = Post::with(['comments' => function ($query) {
    $query->orderBy('likes_count', 'desc')->take(5);
}])->get();

// Multiple conditions on nested relationships
$posts = Post::with(['comments' => function ($query) {
    $query->approved()
          ->with(['user' => function ($q) {
              $q->select('id', 'name', 'avatar');
          }]);
}])->get();</code></pre>

                    <h5>Conditional Loading Based on Data</h5>
                    <pre><code class="language-php">// Load different relationships based on user type
$users = User::with(['posts' => function ($query) {
    $query->published();
}])->when(auth()->user()->isAdmin(), function ($query) {
    return $query->with('drafts');
})->get();

// Load relationships based on request parameters
$posts = Post::with(['comments' => function ($query) use ($request) {
    if ($request->has('approved_only')) {
        $query->approved();
    }
}])->get();</code></pre>
                </div>

                <h3>Eager Loading with Counts</h3>
                <div class="example-section">
                    <h5>Count Related Models</h5>
                    <pre><code class="language-php">// Load posts with comment count
$posts = Post::withCount('comments')->get();

foreach ($posts as $post) {
    echo $post->title . ' (' . $post->comments_count . ' comments)';
}

// Multiple counts
$posts = Post::withCount(['comments', 'likes', 'shares'])->get();

// Count with conditions
$posts = Post::withCount(['comments as approved_comments_count' => function ($query) {
    $query->where('approved', true);
}])->get();

// Count nested relationships
$users = User::withCount('posts.comments')->get();

foreach ($users as $user) {
    echo $user->name . ' has posts with ' . $user->posts_comments_count . ' total comments';
}</code></pre>

                    <h5>Average, Sum, Min, Max</h5>
                    <pre><code class="language-php">// Get average rating for products
$products = Product::withAvg('ratings', 'rating')->get();

// Multiple aggregations
$posts = Post::withSum('comments', 'likes_count')
             ->withAvg('comments', 'likes_count')
             ->withMax('comments', 'created_at')
             ->withMin('comments', 'created_at')
             ->get();

// Conditional aggregations
$posts = Post::withSum(['comments as total_approved_likes' => function ($query) {
    $query->where('approved', true);
}], 'likes_count')->get();</code></pre>
                </div>

                <h3>Lazy Eager Loading</h3>
                <div class="example-section">
                    <h5>Load Missing Relationships</h5>
                    <pre><code class="language-php">// Load posts first
$posts = Post::all();

// Later, lazy eager load users to avoid N+1
$posts->load('user');

// Lazy eager load with constraints
$posts->load(['comments' => function ($query) {
    $query->approved()->with('user');
}]);

// Check if relationship is loaded
if ($posts->first()->relationLoaded('user')) {
    echo 'User relationship is already loaded';
}

// Load if not already loaded
$posts->loadMissing('user', 'tags');</code></pre>

                    <h5>Lazy Eager Loading Counts</h5>
                    <pre><code class="language-php">// Load counts after initial query
$posts = Post::all();
$posts->loadCount('comments', 'likes');

// Load count with conditions
$posts->loadCount(['comments as approved_comments_count' => function ($query) {
    $query->approved();
}]);</code></pre>
                </div>

                <h3>Global Eager Loading</h3>
                <div class="example-section">
                    <h5>Model-level Eager Loading</h5>
                    <pre><code class="language-php">// In your model, always load certain relationships
class Post extends Model
{
    protected $with = ['user', 'tags'];
    
    // This will always eager load user and tags
    // $posts = Post::all(); // Automatically includes user and tags
}

// Override global eager loading when needed
$posts = Post::without('user', 'tags')->get();

// Add to global eager loading
$posts = Post::with('comments')->get(); // Will load user, tags, and comments</code></pre>

                    <h5>Conditional Global Loading</h5>
                    <pre><code class="language-php">class Post extends Model
{
    protected function boot()
    {
        parent::boot();
        
        // Always load user except for API requests
        if (!request()->is('api/*')) {
            $this->with[] = 'user';
        }
    }
}</code></pre>
                </div>

                <h3>Eager Loading Best Practices</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-check"></i> Do's</h4>
                        <ul>
                            <li>Always eager load when you know you'll need the relationship</li>
                            <li>Use specific selects to reduce memory usage</li>
                            <li>Profile your queries to identify N+1 problems</li>
                            <li>Use lazy eager loading when relationships are conditionally needed</li>
                            <li>Combine eager loading with pagination for large datasets</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-times"></i> Don'ts</h4>
                        <ul>
                            <li>Don't over-eager load relationships you don't need</li>
                            <li>Don't forget to eager load in loops</li>
                            <li>Don't use global eager loading for heavy relationships</li>
                            <li>Don't ignore memory usage with large datasets</li>
                            <li>Don't forget to use constraints to limit loaded data</li>
                        </ul>
                    </div>
                </div>

                <h3>Performance Optimization Examples</h3>
                <div class="example-section">
                    <h5>Optimizing Large Datasets</h5>
                    <pre><code class="language-php">// Use select to load only needed columns
$posts = Post::with(['user:id,name,email'])
             ->select('id', 'title', 'user_id', 'created_at')
             ->get();

// Chunk large datasets with eager loading
Post::with('user', 'tags')
    ->chunk(100, function ($posts) {
        foreach ($posts as $post) {
            // Process posts with eager loaded relationships
        }
    });

// Use cursor for memory-efficient processing
foreach (Post::with('user')->cursor() as $post) {
    // Process one by one with minimal memory usage
}</code></pre>

                    <h5>Complex Eager Loading Scenarios</h5>
                    <pre><code class="language-php">// Load posts with complex nested relationships
$posts = Post::with([
    'user' => function ($query) {
        $query->select('id', 'name', 'email')
              ->with(['profile:user_id,avatar,bio']);
    },
    'comments' => function ($query) {
        $query->approved()
              ->with(['user:id,name'])
              ->select('id', 'post_id', 'user_id', 'content', 'created_at')
              ->orderBy('created_at', 'desc')
              ->take(5);
    },
    'tags:id,name,slug',
    'category:id,name'
])->published()
  ->orderBy('created_at', 'desc')
  ->paginate(10);</code></pre>
                </div>

                <h3>Debugging Eager Loading</h3>
                <div class="example-section">
                    <h5>Query Debugging</h5>
                    <pre><code class="language-php">// Enable query logging
DB::enableQueryLog();

$posts = Post::with('user', 'comments.user')->get();

// Check executed queries
$queries = DB::getQueryLog();
dd($queries); // See how many queries were executed

// Use Laravel Debugbar or Telescope for visual debugging

// Check if relationship is loaded
if ($post->relationLoaded('user')) {
    echo 'User is eager loaded';
} else {
    echo 'User will be lazy loaded (potential N+1)';
}</code></pre>

                    <h5>Performance Monitoring</h5>
                    <pre><code class="language-php">// Monitor query performance
class PostController extends Controller
{
    public function index()
    {
        $startTime = microtime(true);
        $startMemory = memory_get_usage();
        
        $posts = Post::with(['user', 'comments.user', 'tags'])
                     ->paginate(20);
        
        $endTime = microtime(true);
        $endMemory = memory_get_usage();
        
        Log::info('Posts loaded', [
            'execution_time' => ($endTime - $startTime) * 1000 . 'ms',
            'memory_used' => ($endMemory - $startMemory) / 1024 . 'KB',
            'query_count' => count(DB::getQueryLog())
        ]);
        
        return view('posts.index', compact('posts'));
    }
}</code></pre>
                </div>
            </section>

            <!-- Lazy Loading -->
            <section class="section" id="lazy-loading">
                <h2><i class="fas fa-hourglass-half"></i> Lazy Loading</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> What is Lazy Loading?</h4>
                    <p><strong>Lazy Loading</strong> is the default behavior where related models are loaded only when they are actually accessed. While this can be convenient, it can lead to the N+1 query problem if not handled properly.</p>
                </div>

                <h3>How Lazy Loading Works</h3>
                <div class="example-section">
                    <h5>Basic Lazy Loading</h5>
                    <pre><code class="language-php">// Get a post without loading relationships
$post = Post::find(1);

// User is loaded only when accessed (lazy loading)
echo $post->user->name; // This triggers a query to load user

// Comments are loaded only when accessed
foreach ($post->comments as $comment) { // This triggers a query to load comments
    echo $comment->content;
}</code></pre>

                    <h5>The Problem with Lazy Loading in Loops</h5>
                    <pre><code class="language-php">// BAD: This causes N+1 queries
$posts = Post::all(); // 1 query

foreach ($posts as $post) {
    echo $post->user->name; // N queries (one for each post)
    
    foreach ($post->comments as $comment) { // N more queries
        echo $comment->content;
    }
}

// If you have 10 posts, this could execute 1 + 10 + 10 = 21 queries!</code></pre>
                </div>

                <h3>Preventing Lazy Loading</h3>
                <div class="example-section">
                    <h5>Disable Lazy Loading Globally</h5>
                    <pre><code class="language-php">// In AppServiceProvider boot() method
Model::preventLazyLoading();

// In production, you might want to log instead of throwing exceptions
Model::preventLazyLoading(!app()->isProduction());

// This will throw an exception when lazy loading occurs
$posts = Post::all();
foreach ($posts as $post) {
    echo $post->user->name; // Exception: Attempted to lazy load [user] on model [Post]
}</code></pre>

                    <h5>Disable for Specific Models</h5>
                    <pre><code class="language-php">// In a specific model
class Post extends Model
{
    protected $preventsLazyLoading = true;
}

// Or disable during runtime
$post = Post::find(1);
$post->preventsLazyLoading();

echo $post->user->name; // Will throw exception</code></pre>
                </div>

                <h3>When Lazy Loading is Acceptable</h3>
                <div class="example-section">
                    <h5>Single Model Access</h5>
                    <pre><code class="language-php">// OK: Loading relationships for a single model
$post = Post::find(1);

// These are fine since it's not in a loop
echo $post->user->name;        // 1 query
echo $post->category->name;    // 1 query

// Check if the post has comments before loading
if ($post->comments()->exists()) { // 1 query to check existence
    $comments = $post->comments; // 1 query to load comments
}</code></pre>

                    <h5>Conditional Loading</h5>
                    <pre><code class="language-php">// Load relationship only when needed
$post = Post::find(1);

if ($request->has('include_comments')) {
    $comments = $post->comments; // Load only when requested
}

// Load relationship based on business logic
if ($post->hasComments()) {
    $latestComments = $post->comments()->latest()->take(5)->get();
}</code></pre>
                </div>

                <h3>Lazy Loading vs Eager Loading Decision Guide</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-rocket"></i> Use Eager Loading When</h4>
                        <ul>
                            <li>You know you'll need the relationship</li>
                            <li>Working with collections of models</li>
                            <li>Displaying data in views/templates</li>
                            <li>Processing multiple records in loops</li>
                            <li>Performance is critical</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-hourglass-half"></i> Use Lazy Loading When</h4>
                        <ul>
                            <li>Working with single models</li>
                            <li>Relationship access is conditional</li>
                            <li>Memory usage is a concern</li>
                            <li>You're not sure if you'll need the data</li>
                            <li>Loading would fetch too much unused data</li>
                        </ul>
                    </div>
                </div>

                <h3>Smart Loading Strategies</h3>
                <div class="example-section">
                    <h5>Lazy Eager Loading (Load Missing)</h5>
                    <pre><code class="language-php">// Start with basic models
$posts = Post::all();

// Later, when you discover you need users, lazy eager load them
$posts->loadMissing('user');

// Now you can safely loop without N+1 queries
foreach ($posts as $post) {
    echo $post->user->name; // No additional queries
}

// Load multiple relationships when needed
$posts->loadMissing(['comments.user', 'tags']);</code></pre>

                    <h5>Conditional Eager Loading</h5>
                    <pre><code class="language-php">// Load relationships based on request parameters
$query = Post::query();

if ($request->has('include_user')) {
    $query->with('user');
}

if ($request->has('include_comments')) {
    $query->with(['comments' => function ($q) {
        $q->latest()->take(5);
    }]);
}

$posts = $query->get();</code></pre>
                </div>

                <h3>Hybrid Approach: Strategic Loading</h3>
                <div class="example-section">
                    <h5>Load Core Data Eagerly, Details Lazily</h5>
                    <pre><code class="language-php">// Load essential relationships eagerly
$posts = Post::with('user:id,name', 'category:id,name')->get();

// Load additional details lazily when needed
foreach ($posts as $post) {
    echo $post->user->name;      // Already loaded
    echo $post->category->name;  // Already loaded
    
    // Load detailed user profile only if needed
    if ($showDetailedUser) {
        $profile = $post->user->profile; // Lazy load when needed
    }
    
    // Load comments only for featured posts
    if ($post->is_featured) {
        $comments = $post->comments()->approved()->take(3)->get();
    }
}</code></pre>

                    <h5>Paginated Lazy Loading</h5>
                    <pre><code class="language-php">// For large datasets, use pagination with strategic loading
class PostController extends Controller
{
    public function index(Request $request)
    {
        $posts = Post::with(['user:id,name', 'category:id,name'])
                     ->latest()
                     ->paginate(10);
        
        // Lazy load additional data for current page only
        if ($request->has('detailed')) {
            $posts->loadMissing(['user.profile', 'tags']);
        }
        
        return view('posts.index', compact('posts'));
    }
    
    public function show(Post $post)
    {
        // For single post view, lazy loading is fine
        return view('posts.show', [
            'post' => $post,
            'user' => $post->user,           // Lazy load
            'comments' => $post->comments()   // Lazy load with constraints
                               ->approved()
                               ->with('user:id,name')
                               ->latest()
                               ->paginate(10)
        ]);
    }
}</code></pre>
                </div>

                <h3>Performance Monitoring for Lazy Loading</h3>
                <div class="example-section">
                    <h5>Query Counting Middleware</h5>
                    <pre><code class="language-php">// Create middleware to monitor query count
class QueryCounterMiddleware
{
    public function handle($request, Closure $next)
    {
        $startCount = count(DB::getQueryLog());
        
        $response = $next($request);
        
        $queryCount = count(DB::getQueryLog()) - $startCount;
        
        if ($queryCount > 10) { // Threshold for concern
            Log::warning('High query count detected', [
                'url' => $request->url(),
                'query_count' => $queryCount,
                'queries' => DB::getQueryLog()
            ]);
        }
        
        return $response;
    }
}</code></pre>

                    <h5>Development Helper</h5>
                    <pre><code class="language-php">// Helper class for development
class LazyLoadingHelper
{
    public static function detectN1Issues()
    {
        if (!app()->environment('local')) {
            return;
        }
        
        $originalCount = count(DB::getQueryLog());
        
        // Your code here...
        $posts = Post::all();
        foreach ($posts as $post) {
            echo $post->user->name;
        }
        
        $newCount = count(DB::getQueryLog());
        $queryIncrease = $newCount - $originalCount;
        
        if ($queryIncrease > 10) {
            dump("Potential N+1 detected: {$queryIncrease} queries executed");
            dump(array_slice(DB::getQueryLog(), $originalCount));
        }
    }
}</code></pre>
                </div>

                <h3>Best Practices Summary</h3>
                <div class="alert info">
                    <strong>Lazy Loading Guidelines:</strong>
                    <ul>
                        <li><strong>Single Models:</strong> Lazy loading is usually fine</li>
                        <li><strong>Collections/Loops:</strong> Almost always use eager loading</li>
                        <li><strong>Conditional Access:</strong> Lazy loading can be appropriate</li>
                        <li><strong>Development:</strong> Enable lazy loading prevention to catch issues</li>
                        <li><strong>Production:</strong> Monitor query counts and performance</li>
                        <li><strong>Hybrid Approach:</strong> Combine eager and lazy loading strategically</li>
                    </ul>
                </div>
            </section>

            <!-- Relationship Methods -->
            <section class="section" id="relationship-methods">
                <h2><i class="fas fa-cogs"></i> Relationship Methods</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-info-circle"></i> Relationship Methods</h4>
                    <p>Laravel Eloquent provides numerous methods to work with relationships efficiently. These methods allow you to query, manipulate, and interact with related models in various ways.</p>
                </div>

                <h3>Querying Relationships</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-search"></i> Existence Queries</h4>
                        <pre><code class="language-php">// Check if relationship exists
$usersWithPosts = User::has('posts')->get();

// Check minimum count
$prolificUsers = User::has('posts', '>=', 10)->get();

// Check with conditions
$usersWithPublishedPosts = User::whereHas('posts', function ($query) {
    $query->where('published', true);
})->get();

// Check doesn't have relationship
$usersWithoutPosts = User::doesntHave('posts')->get();

// Check doesn't have with conditions
$usersWithoutPublishedPosts = User::whereDoesntHave('posts', function ($query) {
    $query->where('published', true);
})->get();</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-calculator"></i> Counting Relationships</h4>
                        <pre><code class="language-php">// Count related models
$usersWithPostCount = User::withCount('posts')->get();

// Multiple counts
$users = User::withCount(['posts', 'comments', 'likes'])->get();

// Count with conditions
$users = User::withCount(['posts as published_posts_count' => function ($query) {
    $query->where('published', true);
}])->get();

// Count nested relationships
$users = User::withCount('posts.comments')->get();

foreach ($users as $user) {
    echo $user->name . ': ' . $user->posts_count . ' posts';
    echo ' (' . $user->published_posts_count . ' published)';
}</code></pre>
                    </div>
                </div>

                <h3>Aggregating Relationship Data</h3>
                <div class="example-section">
                    <h5>Sum, Average, Min, Max</h5>
                    <pre><code class="language-php">// Sum related values
$users = User::withSum('orders', 'total')->get();

// Average
$products = Product::withAvg('reviews', 'rating')->get();

// Multiple aggregations
$posts = Post::withSum('comments', 'likes_count')
             ->withAvg('comments', 'likes_count')
             ->withMax('comments', 'created_at')
             ->withMin('comments', 'created_at')
             ->get();

// Conditional aggregations
$users = User::withSum(['orders as completed_orders_total' => function ($query) {
    $query->where('status', 'completed');
}], 'total')->get();

foreach ($users as $user) {
    echo $user->name . ': $' . $user->orders_sum_total . ' total orders';
    echo ' ($' . $user->completed_orders_total . ' completed)';
}</code></pre>

                    <h5>Custom Aggregations</h5>
                    <pre><code class="language-php">// Custom aggregation with raw expressions
$users = User::select('*')
             ->selectRaw('(
                 SELECT AVG(rating) 
                 FROM reviews 
                 WHERE reviews.reviewable_id = users.id 
                 AND reviews.reviewable_type = ?
             ) as avg_rating', [User::class])
             ->get();

// Using subquery for complex aggregations
$posts = Post::select('*')
             ->addSelect(['latest_comment' => Comment::select('content')
                 ->whereColumn('post_id', 'posts.id')
                 ->latest()
                 ->limit(1)
             ])
             ->get();</code></pre>
                </div>

                <h3>Relationship Manipulation Methods</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-plus"></i> Creating Related Models</h4>
                        <pre><code class="language-php">// Create single related model
$user = User::find(1);
$post = $user->posts()->create([
    'title' => 'New Post',
    'content' => 'Post content'
]);

// Create multiple related models
$user->posts()->createMany([
    ['title' => 'Post 1', 'content' => 'Content 1'],
    ['title' => 'Post 2', 'content' => 'Content 2']
]);

// Create or update
$profile = $user->profile()->updateOrCreate(
    ['user_id' => $user->id],
    ['bio' => 'Updated bio', 'website' => 'https://example.com']
);

// Create and associate existing model
$post = new Post(['title' => 'Title', 'content' => 'Content']);
$user->posts()->save($post);

// Save multiple existing models
$posts = collect([
    new Post(['title' => 'Post 1', 'content' => 'Content 1']),
    new Post(['title' => 'Post 2', 'content' => 'Content 2'])
]);
$user->posts()->saveMany($posts);</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-edit"></i> Updating Related Models</h4>
                        <pre><code class="language-php">// Update all related models
$user->posts()->update(['published' => true]);

// Update with conditions
$user->posts()
     ->where('created_at', '<', now()->subDays(30))
     ->update(['archived' => true]);

// Update or create
$user->profile()->updateOrCreate(
    ['user_id' => $user->id],
    ['bio' => 'New bio']
);

// Update specific related model
$user->posts()->find(1)->update(['title' => 'Updated Title']);

// Update pivot data (many-to-many)
$user->roles()->updateExistingPivot($roleId, [
    'expires_at' => now()->addYear()
]);</code></pre>
                    </div>
                </div>

                <h3>Many-to-Many Specific Methods</h3>
                <div class="example-section">
                    <h5>Attach/Detach Operations</h5>
                    <pre><code class="language-php">$user = User::find(1);

// Attach single relationship
$user->roles()->attach(1);
$user->roles()->attach($role);

// Attach with pivot data
$user->roles()->attach(1, ['expires_at' => now()->addYear()]);

// Attach multiple
$user->roles()->attach([1, 2, 3]);
$user->roles()->attach([
    1 => ['expires_at' => now()->addYear()],
    2 => ['expires_at' => now()->addMonths(6)]
]);

// Detach relationships
$user->roles()->detach(1);      // Detach specific
$user->roles()->detach([1, 2]); // Detach multiple
$user->roles()->detach();       // Detach all</code></pre>

                    <h5>Sync Operations</h5>
                    <pre><code class="language-php">// Sync relationships (add new, remove missing)
$user->roles()->sync([1, 2, 3]);

// Sync with pivot data
$user->roles()->sync([
    1 => ['expires_at' => now()->addYear()],
    2 => ['expires_at' => now()->addMonths(6)]
]);

// Sync without detaching existing
$user->roles()->syncWithoutDetaching([4, 5]);

// Sync with pivot values for all
$user->roles()->syncWithPivotValues([1, 2, 3], [
    'assigned_by' => auth()->id(),
    'assigned_at' => now()
]);

// Toggle relationships
$user->roles()->toggle([1, 2, 3]); // Attach if not exists, detach if exists</code></pre>
                </div>

                <h3>Querying Through Relationships</h3>
                <div class="example-section">
                    <h5>Filtering Parent Models by Relationships</h5>
                    <pre><code class="language-php">// Get users who have posts
$activeUsers = User::whereHas('posts')->get();

// Get users with specific post conditions
$bloggers = User::whereHas('posts', function ($query) {
    $query->where('published', true)
          ->where('created_at', '>=', now()->subMonths(6));
})->get();

// Complex relationship queries
$influencers = User::whereHas('posts', function ($query) {
    $query->whereHas('comments', function ($q) {
        $q->where('created_at', '>=', now()->subWeek());
    }, '>=', 10);
}, '>=', 5)->get();

// Users who don't have posts
$inactiveUsers = User::whereDoesntHave('posts')->get();

// Users who don't have recent posts
$staleUsers = User::whereDoesntHave('posts', function ($query) {
    $query->where('created_at', '>=', now()->subMonths(3));
})->get();</code></pre>

                    <h5>Ordering by Relationship Data</h5>
                    <pre><code class="language-php">// Order users by post count
$users = User::withCount('posts')
             ->orderBy('posts_count', 'desc')
             ->get();

// Order by latest relationship
$users = User::orderByDesc(
    Post::select('created_at')
        ->whereColumn('user_id', 'users.id')
        ->latest()
        ->limit(1)
)->get();

// Order by relationship aggregate
$products = Product::orderByDesc(
    Review::selectRaw('AVG(rating)')
        ->whereColumn('product_id', 'products.id')
)->get();</code></pre>
                </div>

                <h3>Advanced Relationship Queries</h3>
                <div class="example-section">
                    <h5>Subquery Selects</h5>
                    <pre><code class="language-php">// Add subquery columns
$posts = Post::select('*')
             ->addSelect(['user_name' => User::select('name')
                 ->whereColumn('id', 'posts.user_id')
             ])
             ->addSelect(['comments_count' => Comment::selectRaw('count(*)')
                 ->whereColumn('post_id', 'posts.id')
                 ->where('approved', true)
             ])
             ->get();

// Complex subqueries
$users = User::select('*')
             ->addSelect(['latest_post_title' => Post::select('title')
                 ->whereColumn('user_id', 'users.id')
                 ->latest()
                 ->limit(1)
             ])
             ->addSelect(['total_post_views' => Post::selectRaw('SUM(views_count)')
                 ->whereColumn('user_id', 'users.id')
                 ->where('published', true)
             ])
             ->get();</code></pre>

                    <h5>Dynamic Relationship Loading</h5>
                    <pre><code class="language-php">// Load relationships based on conditions
$posts = Post::query()
    ->when($includeAuthor, fn($q) => $q->with('user'))
    ->when($includeComments, fn($q) => $q->with('comments'))
    ->when($includeTags, fn($q) => $q->with('tags'))
    ->get();

// Load different relationships based on user permissions
$posts = Post::query()
    ->with(['user:id,name'])
    ->when(auth()->user()->can('moderate'), function ($query) {
        return $query->with('reports');
    })
    ->when(auth()->user()->isAdmin(), function ($query) {
        return $query->with(['user:id,name,email', 'editHistory']);
    })
    ->get();</code></pre>
                </div>

                <h3>Relationship Method Utilities</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-tools"></i> Utility Methods</h4>
                        <pre><code class="language-php">// Check if relationship is loaded
if ($post->relationLoaded('user')) {
    echo 'User is already loaded';
}

// Get relationship without loading
$userQuery = $post->user(); // Returns relationship query
$userCount = $post->user()->count(); // Count without loading

// Get foreign key value
$userId = $post->user()->getParentKey();

// Check if models are related
if ($user->posts()->where('id', $postId)->exists()) {
    echo 'User owns this post';
}

// Get relationship name
$relationshipName = $post->user()->getRelationName(); // 'user'</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-database"></i> Raw Relationship Queries</h4>
                        <pre><code class="language-php">// Raw where clauses on relationships
$posts = Post::whereHas('user', function ($query) {
    $query->whereRaw('YEAR(created_at) = ?', [2024]);
})->get();

// Raw aggregations
$users = User::withCount(['posts' => function ($query) {
    $query->selectRaw('COUNT(*) as total')
          ->whereRaw('published_at IS NOT NULL');
}])->get();

// Custom pivot queries
$users = User::with(['roles' => function ($query) {
    $query->wherePivot('active', true)
          ->wherePivotBetween('created_at', [
              now()->subYear(),
              now()
          ]);
}])->get();</code></pre>
                    </div>
                </div>

                <h3>Performance Optimization Methods</h3>
                <div class="example-section">
                    <h5>Efficient Counting</h5>
                    <pre><code class="language-php">// Don't load all models just to count
$postCount = $user->posts()->count(); // Good
$postCount = $user->posts->count();   // Bad - loads all posts

// Count with conditions
$publishedCount = $user->posts()->where('published', true)->count();

// Multiple counts efficiently
$user = User::withCount([
    'posts',
    'posts as published_posts_count' => function ($query) {
        $query->where('published', true);
    },
    'posts as draft_posts_count' => function ($query) {
        $query->where('published', false);
    }
])->find(1);</code></pre>

                    <h5>Chunking Relationship Operations</h5>
                    <pre><code class="language-php">// Process large relationship datasets in chunks
$user->posts()->chunk(100, function ($posts) {
    foreach ($posts as $post) {
        // Process each post
        $post->update(['processed' => true]);
    }
});

// Chunk with relationships
$user->posts()->with('comments')->chunk(50, function ($posts) {
    foreach ($posts as $post) {
        // Process posts with comments loaded
    }
});</code></pre>
                </div>
            </section>

            <!-- Best Practices -->
            <section class="section" id="best-practices">
                <h2><i class="fas fa-star"></i> Best Practices</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-lightbulb"></i> Laravel Eloquent Relationships Best Practices</h4>
                    <p>Following best practices ensures your Laravel application is maintainable, performant, and scalable. These guidelines will help you write better relationship code.</p>
                </div>

                <h3>Database Design Best Practices</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-database"></i> Foreign Key Constraints</h4>
                        <pre><code class="language-php">// Always use foreign key constraints
Schema::create('posts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('title');
    $table->text('content');
    $table->timestamps();
});

// For soft deletes, use restrict instead of cascade
$table->foreignId('user_id')->constrained()->onDelete('restrict');

// Custom foreign key names
$table->foreignId('author_id')->constrained('users')->onDelete('cascade');</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-index"></i> Proper Indexing</h4>
                        <pre><code class="language-php">// Index foreign keys for better query performance
Schema::create('posts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained();
    $table->foreignId('category_id')->constrained();
    $table->string('title');
    $table->timestamps();
    
    // Composite indexes for common query patterns
    $table->index(['user_id', 'created_at']);
    $table->index(['category_id', 'published']);
});

// Index polymorphic relationships
$table->index(['commentable_id', 'commentable_type']);</code></pre>
                    </div>
                </div>

                <h3>Model Structure Best Practices</h3>
                <div class="example-section">
                    <h5>Consistent Naming Conventions</h5>
                    <pre><code class="language-php">// Follow Laravel naming conventions
class User extends Model
{
    // Singular relationship names for hasOne, belongsTo
    public function profile()      // Not profiles()
    {
        return $this->hasOne(Profile::class);
    }
    
    // Plural relationship names for hasMany, belongsToMany
    public function posts()        // Not post()
    {
        return $this->hasMany(Post::class);
    }
    
    public function roles()        // Not role()
    {
        return $this->belongsToMany(Role::class);
    }
}

// Use descriptive relationship names
public function publishedPosts()
{
    return $this->hasMany(Post::class)->where('published', true);
}

public function recentComments()
{
    return $this->hasMany(Comment::class)->where('created_at', '>=', now()->subDays(7));
}</code></pre>

                    <h5>Model Organization</h5>
                    <pre><code class="language-php">class Post extends Model
{
    // 1. Properties and constants
    protected $fillable = ['title', 'content', 'user_id'];
    protected $casts = ['published_at' => 'datetime'];
    
    // 2. Relationships (group by type)
    // BelongsTo relationships
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    
    public function category()
    {
        return $this->belongsTo(Category::class);
    }
    
    // HasMany relationships  
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }
    
    // BelongsToMany relationships
    public function tags()
    {
        return $this->belongsToMany(Tag::class);
    }
    
    // Polymorphic relationships
    public function images()
    {
        return $this->morphMany(Image::class, 'imageable');
    }
    
    // 3. Scopes
    public function scopePublished($query)
    {
        return $query->where('published', true);
    }
    
    // 4. Accessors and Mutators
    public function getTitleAttribute($value)
    {
        return ucfirst($value);
    }
    
    // 5. Other methods
    public function isPublished()
    {
        return $this->published;
    }
}</code></pre>
                </div>

                <h3>Performance Best Practices</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-rocket"></i> Eager Loading Strategy</h4>
                        <pre><code class="language-php">// Good: Always eager load in collections
$posts = Post::with(['user', 'category', 'tags'])->get();

// Better: Load only needed columns
$posts = Post::with([
    'user:id,name,email',
    'category:id,name',
    'tags:id,name,slug'
])->select('id', 'title', 'user_id', 'category_id')->get();

// Best: Conditional eager loading
$posts = Post::with(['user:id,name'])
    ->when($request->include_comments, fn($q) => $q->with('comments.user:id,name'))
    ->when($request->include_tags, fn($q) => $q->with('tags:id,name'))
    ->get();

// Use global eager loading sparingly
class Post extends Model
{
    // Only for truly essential relationships
    protected $with = ['user:id,name'];
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-chart-line"></i> Query Optimization</h4>
                        <pre><code class="language-php">// Use counts instead of loading all records
$userCount = $post->comments()->count();          // Good
$userCount = $post->comments->count();            // Bad

// Use exists for boolean checks
$hasComments = $post->comments()->exists();       // Good
$hasComments = $post->comments->count() > 0;     // Bad

// Batch operations for better performance
// Update multiple records at once
Post::whereIn('id', $postIds)->update(['published' => true]);

// Use chunk for large datasets
Post::with('user')->chunk(100, function ($posts) {
    foreach ($posts as $post) {
        // Process posts
    }
});

// Use cursors for memory efficiency
foreach (Post::with('user')->cursor() as $post) {
    // Process one by one
}</code></pre>
                    </div>
                </div>

                <h3>Security Best Practices</h3>
                <div class="example-section">
                    <h5>Mass Assignment Protection</h5>
                    <pre><code class="language-php">class Post extends Model
{
    // Use fillable (whitelist approach - recommended)
    protected $fillable = ['title', 'content', 'user_id'];
    
    // Or use guarded (blacklist approach)
    protected $guarded = ['id', 'created_at', 'updated_at'];
    
    // Protect sensitive fields
    protected $hidden = ['user_id', 'internal_notes'];
}

// Always validate before creating relationships
public function store(Request $request)
{
    $validated = $request->validate([
        'title' => 'required|string|max:255',
        'content' => 'required|string',
    ]);
    
    $post = auth()->user()->posts()->create($validated);
    
    return response()->json($post);
}</code></pre>

                    <h5>Authorization Checks</h5>
                    <pre><code class="language-php">// Always check ownership/permissions
public function update(Request $request, Post $post)
{
    // Check if user can update this post
    $this->authorize('update', $post);
    
    $post->update($request->validated());
    
    return response()->json($post);
}

// Use policies for relationship authorization
class PostPolicy
{
    public function update(User $user, Post $post)
    {
        return $user->id === $post->user_id;
    }
    
    public function addComment(User $user, Post $post)
    {
        return $post->allows_comments && $user->isActive();
    }
}</code></pre>
                </div>

                <h3>Code Organization Best Practices</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-layer-group"></i> Service Layer</h4>
                        <pre><code class="language-php">// Create service classes for complex relationship logic
class PostService
{
    public function createWithRelationships(array $data, User $user)
    {
        DB::transaction(function () use ($data, $user) {
            $post = $user->posts()->create([
                'title' => $data['title'],
                'content' => $data['content']
            ]);
            
            if (isset($data['tags'])) {
                $post->tags()->sync($data['tags']);
            }
            
            if (isset($data['category_id'])) {
                $post->category()->associate($data['category_id']);
                $post->save();
            }
            
            return $post;
        });
    }
    
    public function getPostsWithMetrics(User $user)
    {
        return $user->posts()
            ->withCount(['comments', 'likes'])
            ->withAvg('comments', 'rating')
            ->with(['tags:id,name', 'category:id,name'])
            ->latest()
            ->get();
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-cogs"></i> Repository Pattern</h4>
                        <pre><code class="language-php">// Use repository pattern for complex queries
interface PostRepositoryInterface
{
    public function getPostsWithRelationships(array $filters = []);
    public function findWithComments(int $id);
}

class PostRepository implements PostRepositoryInterface
{
    public function getPostsWithRelationships(array $filters = [])
    {
        $query = Post::with(['user:id,name', 'category:id,name']);
        
        if (isset($filters['published'])) {
            $query->where('published', $filters['published']);
        }
        
        if (isset($filters['tag'])) {
            $query->whereHas('tags', function ($q) use ($filters) {
                $q->where('slug', $filters['tag']);
            });
        }
        
        return $query->latest()->get();
    }
    
    public function findWithComments(int $id)
    {
        return Post::with([
            'user:id,name',
            'comments' => function ($query) {
                $query->approved()->with('user:id,name')->latest();
            }
        ])->findOrFail($id);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Testing Best Practices</h3>
                <div class="example-section">
                    <h5>Factory Relationships</h5>
                    <pre><code class="language-php">// Define relationship factories properly
class PostFactory extends Factory
{
    protected $model = Post::class;
    
    public function definition()
    {
        return [
            'title' => $this->faker->sentence,
            'content' => $this->faker->paragraphs(3, true),
            'user_id' => User::factory(),
            'published' => true,
        ];
    }
    
    public function withComments($count = 3)
    {
        return $this->has(Comment::factory()->count($count), 'comments');
    }
    
    public function withTags($count = 2)
    {
        return $this->afterCreating(function (Post $post) use ($count) {
            $tags = Tag::factory()->count($count)->create();
            $post->tags()->attach($tags);
        });
    }
}

// Use factories in tests
public function test_user_can_create_post_with_tags()
{
    $user = User::factory()->create();
    $tags = Tag::factory()->count(3)->create();
    
    $response = $this->actingAs($user)
        ->postJson('/posts', [
            'title' => 'Test Post',
            'content' => 'Test content',
            'tags' => $tags->pluck('id')->toArray()
        ]);
        
    $response->assertCreated();
    
    $post = Post::latest()->first();
    $this->assertCount(3, $post->tags);
    $this->assertTrue($post->user->is($user));
}</code></pre>
                </div>

                <h3>Error Handling Best Practices</h3>
                <div class="example-section">
                    <h5>Graceful Relationship Handling</h5>
                    <pre><code class="language-php">// Handle missing relationships gracefully
public function show(Post $post)
{
    $post->load(['user', 'category', 'comments.user']);
    
    return [
        'post' => $post,
        'author' => $post->user ? $post->user->only(['id', 'name']) : null,
        'category' => optional($post->category)->only(['id', 'name']),
        'comments_count' => $post->comments->count(),
        'has_comments' => $post->comments->isNotEmpty()
    ];
}

// Use try-catch for relationship operations
public function attachTag(Post $post, $tagId)
{
    try {
        $tag = Tag::findOrFail($tagId);
        
        if (!$post->tags->contains($tag)) {
            $post->tags()->attach($tag);
            $tag->increment('usage_count');
        }
        
        return response()->json(['message' => 'Tag attached successfully']);
        
    } catch (ModelNotFoundException $e) {
        return response()->json(['error' => 'Tag not found'], 404);
    } catch (\Exception $e) {
        Log::error('Error attaching tag: ' . $e->getMessage());
        return response()->json(['error' => 'Failed to attach tag'], 500);
    }
}</code></pre>
                </div>

                <h3>Documentation Best Practices</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-file-alt"></i> Document Relationships</h4>
                        <pre><code class="language-php">class User extends Model
{
    /**
     * Get all posts created by the user.
     * 
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function posts()
    {
        return $this->hasMany(Post::class);
    }
    
    /**
     * Get only published posts by the user.
     * Used for public-facing author pages.
     * 
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function publishedPosts()
    {
        return $this->hasMany(Post::class)
                    ->where('published', true)
                    ->orderBy('published_at', 'desc');
    }
    
    /**
     * The roles that belong to the user.
     * 
     * @return \Illuminate\Database\Eloquent\Relations\BelongsToMany
     */
    public function roles()
    {
        return $this->belongsToMany(Role::class)
                    ->withTimestamps()
                    ->withPivot('expires_at');
    }
}</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-code"></i> Type Hinting</h4>
                        <pre><code class="language-php">use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Post extends Model
{
    /**
     * Get the user that owns the post.
     */
    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
    
    /**
     * Get the comments for the post.
     */
    public function comments(): HasMany
    {
        return $this->hasMany(Comment::class);
    }
    
    /**
     * The tags that belong to the post.
     */
    public function tags(): BelongsToMany
    {
        return $this->belongsToMany(Tag::class);
    }
}</code></pre>
                    </div>
                </div>

                <h3>Common Anti-Patterns to Avoid</h3>
                <div class="alert danger">
                    <strong>❌ Anti-Patterns to Avoid:</strong>
                    <ul>
                        <li><strong>N+1 Queries:</strong> Not using eager loading in loops</li>
                        <li><strong>Over-eager loading:</strong> Loading unnecessary relationships</li>
                        <li><strong>Fat models:</strong> Putting too much logic in relationship methods</li>
                        <li><strong>Circular dependencies:</strong> Models referencing each other infinitely</li>
                        <li><strong>Direct foreign key access:</strong> Using <code>user_id</code> instead of <code>user</code> relationship</li>
                        <li><strong>Missing constraints:</strong> Not using foreign key constraints in migrations</li>
                        <li><strong>Inconsistent naming:</strong> Not following Laravel naming conventions</li>
                    </ul>
                </div>

                <h3>Performance Checklist</h3>
                <div class="alert success">
                    <strong>✅ Performance Checklist:</strong>
                    <ul>
                        <li>Use eager loading for collections and loops</li>
                        <li>Select only needed columns with <code>:id,name</code> syntax</li>
                        <li>Use <code>count()</code>, <code>exists()</code> instead of loading all records</li>
                        <li>Index foreign keys and polymorphic columns</li>
                        <li>Use database-level constraints</li>
                        <li>Implement proper pagination for large datasets</li>
                        <li>Use transactions for multiple relationship operations</li>
                        <li>Monitor and profile your queries in production</li>
                    </ul>
                </div>
            </section>

            <!-- Troubleshooting -->
            <section class="section" id="troubleshooting">
                <h2><i class="fas fa-bug"></i> Troubleshooting Common Issues</h2>
                
                <div class="relationship-card">
                    <h4><i class="fas fa-tools"></i> Common Relationship Issues</h4>
                    <p>This section covers the most common problems developers encounter when working with Eloquent relationships and provides solutions to resolve them.</p>
                </div>

                <h3>N+1 Query Problem</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-exclamation-triangle"></i> Problem</h4>
                        <pre><code class="language-php">// This creates N+1 queries
$posts = Post::all(); // 1 query

foreach ($posts as $post) {
    echo $post->user->name; // N additional queries
}</code></pre>
                        <p class="text-danger">If you have 100 posts, this executes 101 queries!</p>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-check-circle"></i> Solution</h4>
                        <pre><code class="language-php">// Use eager loading
$posts = Post::with('user')->get(); // 2 queries total

foreach ($posts as $post) {
    echo $post->user->name; // No additional queries
}

// Or use lazy eager loading
$posts = Post::all();
$posts->load('user'); // Load all users in one query</code></pre>
                        <p class="text-success">Always executes only 2 queries regardless of post count!</p>
                    </div>
                </div>

                <h3>Relationship Not Found Errors</h3>
                <div class="example-section">
                    <h5>Problem: Call to undefined method</h5>
                    <pre><code class="language-bash"># Error message
Call to undefined method Illuminate\Database\Eloquent\Builder::posts</code></pre>

                    <h5>Causes and Solutions</h5>
                    <pre><code class="language-php">// ❌ Wrong: Calling relationship on query builder
$posts = User::where('active', true)->posts(); // Error!

// ✅ Correct: Get model first, then access relationship
$posts = User::where('active', true)->first()->posts;

// ✅ Or use whereHas to query through relationship
$users = User::whereHas('posts', function ($query) {
    $query->where('published', true);
})->get();

// ❌ Wrong: Typo in relationship method name
public function post() // Should be posts() for hasMany
{
    return $this->hasMany(Post::class);
}

// ✅ Correct: Use proper naming convention
public function posts() // Plural for hasMany
{
    return $this->hasMany(Post::class);
}

public function user() // Singular for belongsTo
{
    return $this->belongsTo(User::class);
}</code></pre>
                </div>

                <h3>Foreign Key Constraint Errors</h3>
                <div class="example-section">
                    <h5>Problem: SQLSTATE[23000] Integrity constraint violation</h5>
                    <pre><code class="language-bash"># Error message
SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails</code></pre>

                    <h5>Solutions</h5>
                    <pre><code class="language-php">// ❌ Problem: Trying to create post with non-existent user
Post::create([
    'title' => 'Test Post',
    'content' => 'Content',
    'user_id' => 999 // User doesn't exist
]);

// ✅ Solution 1: Validate foreign key exists
$request->validate([
    'user_id' => 'required|exists:users,id'
]);

// ✅ Solution 2: Use relationship methods
$user = User::find($userId);
if ($user) {
    $post = $user->posts()->create([
        'title' => 'Test Post',
        'content' => 'Content'
    ]);
}

// ✅ Solution 3: Make foreign key nullable if optional
Schema::table('posts', function (Blueprint $table) {
    $table->foreignId('user_id')->nullable()->constrained();
});

// ✅ Solution 4: Handle constraint on delete
Schema::table('posts', function (Blueprint $table) {
    $table->foreignId('user_id')
          ->constrained()
          ->onDelete('cascade'); // Delete posts when user is deleted
});</code></pre>
                </div>

                <h3>Polymorphic Relationship Issues</h3>
                <div class="example-section">
                    <h5>Problem: Polymorphic relationship not working</h5>
                    <pre><code class="language-php">// ❌ Problem: Wrong morphs setup
Schema::create('comments', function (Blueprint $table) {
    $table->id();
    $table->text('content');
    $table->integer('commentable_id');
    $table->string('commentable_type');
    // Missing index!
});

// ✅ Solution: Proper polymorphic setup
Schema::create('comments', function (Blueprint $table) {
    $table->id();
    $table->text('content');
    $table->morphs('commentable'); // Creates both columns and index
    $table->timestamps();
});

// Or manually with proper indexing
Schema::create('comments', function (Blueprint $table) {
    $table->id();
    $table->text('content');
    $table->unsignedBigInteger('commentable_id');
    $table->string('commentable_type');
    $table->index(['commentable_id', 'commentable_type']);
    $table->timestamps();
});</code></pre>

                    <h5>Problem: Class name changes breaking polymorphic relationships</h5>
                    <pre><code class="language-php">// ❌ Problem: Full class names in database
// Database contains: App\Models\Post, App\Models\Video
// If you move models, relationships break!

// ✅ Solution: Use morph map to alias class names
// In AppServiceProvider boot() method
use Illuminate\Database\Eloquent\Relations\Relation;

Relation::enforceMorphMap([
    'post' => 'App\Models\Post',
    'video' => 'App\Models\Video',
    'product' => 'App\Models\Product',
]);

// Now database stores 'post' instead of full class name</code></pre>
                </div>

                <h3>Pivot Table Issues</h3>
                <div class="example-section">
                    <h5>Problem: Pivot data not accessible</h5>
                    <pre><code class="language-php">// ❌ Problem: Can't access pivot data
$user = User::with('roles')->first();
echo $user->roles->first()->assigned_at; // Error: Property doesn't exist

// ✅ Solution: Specify pivot columns in relationship
public function roles()
{
    return $this->belongsToMany(Role::class)
                ->withTimestamps()
                ->withPivot('assigned_at', 'assigned_by');
}

// Now you can access pivot data
$user = User::with('roles')->first();
echo $user->roles->first()->pivot->assigned_at;</code></pre>

                    <h5>Problem: Duplicate entries in pivot table</h5>
                    <pre><code class="language-php">// ❌ Problem: No unique constraint on pivot table
Schema::create('role_user', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained();
    $table->foreignId('role_id')->constrained();
    $table->timestamps();
    // Missing unique constraint allows duplicates!
});

// ✅ Solution: Add unique constraint
Schema::create('role_user', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained();
    $table->foreignId('role_id')->constrained();
    $table->timestamps();
    
    // Prevent duplicate assignments
    $table->unique(['user_id', 'role_id']);
});</code></pre>
                </div>

                <h3>Circular Reference Issues</h3>
                <div class="example-section">
                    <h5>Problem: Infinite loop when serializing</h5>
                    <pre><code class="language-php">// ❌ Problem: User loads posts, posts load user infinitely
class User extends Model
{
    protected $with = ['posts']; // Always loads posts
    
    public function posts()
    {
        return $this->hasMany(Post::class);
    }
}

class Post extends Model
{
    protected $with = ['user']; // Always loads user
    
    public function user()
    {
        return $this->belongsTo(User::class);
    }
}

// This creates infinite loading loop!</code></pre>

                    <h5>Solutions</h5>
                    <pre><code class="language-php">// ✅ Solution 1: Remove global eager loading
class User extends Model
{
    // Don't use $with for circular relationships
    
    public function posts()
    {
        return $this->hasMany(Post::class);
    }
}

// ✅ Solution 2: Use hidden attributes to prevent serialization loops
class Post extends Model
{
    protected $hidden = ['user']; // Hide from JSON when needed
    
    public function user()
    {
        return $this->belongsTo(User::class);
    }
}

// ✅ Solution 3: Load relationships strategically
$users = User::with(['posts' => function ($query) {
    $query->select('id', 'title', 'user_id'); // Don't load user again
}])->get();</code></pre>
                </div>

                <h3>Performance Issues</h3>
                <div class="example-section">
                    <h5>Problem: Slow queries with relationships</h5>
                    <pre><code class="language-php">// ❌ Problems that cause slow queries

// 1. Loading too much data
$posts = Post::with('user', 'comments', 'tags', 'category')->get();

// 2. No pagination on large datasets
$allPosts = Post::with('user')->get(); // Loads everything

// 3. Deep nesting without limits
$users = User::with('posts.comments.replies.user')->get();</code></pre>

                    <h5>Solutions</h5>
                    <pre><code class="language-php">// ✅ Solution 1: Load only needed columns
$posts = Post::with([
    'user:id,name,email',
    'category:id,name'
])->select('id', 'title', 'user_id', 'category_id')->get();

// ✅ Solution 2: Use pagination
$posts = Post::with('user:id,name')
             ->latest()
             ->paginate(20);

// ✅ Solution 3: Limit deep relationships
$users = User::with([
    'posts' => function ($query) {
        $query->latest()->take(5)->with(['comments' => function ($q) {
            $q->approved()->latest()->take(3);
        }]);
    }
])->get();

// ✅ Solution 4: Use chunking for large operations
Post::with('user')->chunk(100, function ($posts) {
    foreach ($posts as $post) {
        // Process posts in batches
    }
});</code></pre>
                </div>

                <h3>Debugging Tools and Techniques</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4><i class="fas fa-search"></i> Query Debugging</h4>
                        <pre><code class="language-php">// Enable query logging
DB::enableQueryLog();

// Your relationship code here
$posts = Post::with('user', 'comments')->get();

// Check executed queries
$queries = DB::getQueryLog();
foreach ($queries as $query) {
    echo $query['query'] . "\n";
    echo "Time: " . $query['time'] . "ms\n";
    echo "Bindings: " . json_encode($query['bindings']) . "\n\n";
}

// Or use Laravel Debugbar (in development)
// composer require barryvdh/laravel-debugbar --dev

// Check specific relationship queries
$user = User::find(1);
echo $user->posts()->toSql(); // See the SQL query
echo $user->posts()->count(); // Count without loading</code></pre>
                    </div>
                    
                    <div class="feature-card">
                        <h4><i class="fas fa-tools"></i> Relationship Debugging</h4>
                        <pre><code class="language-php">// Check if relationship is loaded
if ($post->relationLoaded('user')) {
    echo "User is already loaded";
} else {
    echo "User will be lazy loaded";
}

// Debug relationship configuration
$relationship = $post->user(); // Returns relationship object
echo get_class($relationship); // Shows relationship type
echo $relationship->getQuery()->toSql(); // Shows SQL

// Check foreign key values
echo $post->user()->getOwnerKey(); // Local key value
echo $post->user()->getForeignKey(); // Foreign key name

// Test relationship existence
if ($post->user()->exists()) {
    echo "User exists";
}

// Prevent lazy loading to catch N+1 issues
Model::preventLazyLoading();
// Now any lazy loading will throw an exception</code></pre>
                    </div>
                </div>

                <h3>Testing Relationships</h3>
                <div class="example-section">
                    <h5>Test Relationship Configuration</h5>
                    <pre><code class="language-php">// Test relationship methods exist
public function test_user_has_posts_relationship()
{
    $user = User::factory()->create();
    
    $this->assertInstanceOf(
        \Illuminate\Database\Eloquent\Relations\HasMany::class,
        $user->posts()
    );
}

// Test relationship data
public function test_user_posts_relationship_works()
{
    $user = User::factory()->create();
    $post = Post::factory()->create(['user_id' => $user->id]);
    
    $this->assertTrue($user->posts->contains($post));
    $this->assertEquals($user->id, $post->user->id);
}

// Test eager loading
public function test_posts_can_be_eager_loaded()
{
    $user = User::factory()
               ->has(Post::factory()->count(3))
               ->create();
    
    DB::enableQueryLog();
    
    $userWithPosts = User::with('posts')->find($user->id);
    
    $queries = DB::getQueryLog();
    
    // Should only execute 2 queries (user + posts)
    $this->assertCount(2, $queries);
    $this->assertCount(3, $userWithPosts->posts);
}</code></pre>
                </div>

                <h3>Common Error Messages and Solutions</h3>
                <div class="alert warning">
                    <h5><strong>Error:</strong> "Class 'App\Post' not found"</h5>
                    <p><strong>Solution:</strong> Update model namespace or specify full path in relationship:</p>
                    <pre><code class="language-php">// Use full namespace or update use statement
public function posts()
{
    return $this->hasMany(\App\Models\Post::class);
}</code></pre>
                </div>

                <div class="alert warning">
                    <h5><strong>Error:</strong> "Trying to get property 'name' of non-object"</h5>
                    <p><strong>Solution:</strong> Check if relationship exists before accessing:</p>
                    <pre><code class="language-php">// Use optional helper or null coalescing
echo optional($post->user)->name;
echo $post->user->name ?? 'No user';

// Or check existence
if ($post->user) {
    echo $post->user->name;
}</code></pre>
                </div>

                <div class="alert warning">
                    <h5><strong>Error:</strong> "Array to string conversion"</h5>
                    <p><strong>Solution:</strong> Don't echo collections, access specific properties:</p>
                    <pre><code class="language-php">// ❌ Wrong: Echoing collection
echo $user->posts; // Error!

// ✅ Correct: Loop through collection or get specific data
foreach ($user->posts as $post) {
    echo $post->title;
}

// Or get count/first item
echo $user->posts->count();
echo $user->posts->first()->title ?? 'No posts';</code></pre>
                </div>
            </section>

        </main>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Only shift content on desktop
            if (window.innerWidth > 768) {
                mainContent.classList.toggle('shifted');
            }
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            mainContent.classList.remove('shifted');
        }

        // Progress Bar
        function updateProgressBar() {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.querySelector('.progress-bar').style.width = scrolled + '%';
        }

        // Back to Top
        function scrollToTop() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }

        function toggleBackToTop() {
            const backToTop = document.getElementById('backToTop');
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        }

        // Active Navigation
        function updateActiveNav() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.sidebar a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }

        // Search Functionality
        function searchContent(query) {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.sidebar a');
            
            if (!query) {
                // Show all sections and nav links
                sections.forEach(section => section.style.display = 'block');
                navLinks.forEach(link => link.style.display = 'block');
                return;
            }

            const searchTerm = query.toLowerCase();
            
            sections.forEach(section => {
                const content = section.textContent.toLowerCase();
                if (content.includes(searchTerm)) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });

            navLinks.forEach(link => {
                const text = link.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    link.style.display = 'block';
                } else {
                    link.style.display = 'none';
                }
            });
        }

        // Smooth Scrolling for Navigation Links
        document.querySelectorAll('.sidebar a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Event Listeners
        window.addEventListener('scroll', () => {
            updateProgressBar();
            toggleBackToTop();
            updateActiveNav();
        });

        // Window resize handler
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const overlay = document.getElementById('overlay');
            
            if (window.innerWidth > 768) {
                // Desktop view
                overlay.classList.remove('active');
                if (sidebar.classList.contains('active')) {
                    mainContent.classList.add('shifted');
                }
            } else {
                // Mobile view
                mainContent.classList.remove('shifted');
            }
        });

        // Click outside sidebar to close (mobile only)
        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('sidebar');
            const navToggle = document.querySelector('.nav-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(e.target) && 
                !navToggle.contains(e.target) && 
                sidebar.classList.contains('active')) {
                closeSidebar();
            }
        });

        // Touch support for mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const sidebar = document.getElementById('sidebar');
            
            if (window.innerWidth <= 768) {
                // Swipe right to open sidebar
                if (touchEndX - touchStartX > swipeThreshold && touchStartX < 50) {
                    if (!sidebar.classList.contains('active')) {
                        toggleSidebar();
                    }
                }
                // Swipe left to close sidebar
                else if (touchStartX - touchEndX > swipeThreshold && sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateProgressBar();
            updateActiveNav();
        });

        // Copy code functionality
        document.addEventListener('DOMContentLoaded', () => {
            // Add copy buttons to code blocks
            const codeBlocks = document.querySelectorAll('pre code');
            codeBlocks.forEach((block, index) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.innerHTML = '<i class="fas fa-copy"></i>';
                button.title = 'Copy code';
                
                button.addEventListener('click', () => {
                    navigator.clipboard.writeText(block.textContent).then(() => {
                        button.innerHTML = '<i class="fas fa-check"></i>';
                        setTimeout(() => {
                            button.innerHTML = '<i class="fas fa-copy"></i>';
                        }, 2000);
                    });
                });
                
                block.parentNode.style.position = 'relative';
                block.parentNode.appendChild(button);
            });
        });
    </script>
</body>
</html>